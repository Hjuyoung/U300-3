<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#16a34a">
    <meta name="description" content="ÏùåÏÑ±ÏúºÎ°ú Í∞ÑÌé∏ÌïòÍ≤å ÏòÅÎÜçÏùºÏßÄÎ•º Í∏∞Î°ùÌïòÍ≥† Í¥ÄÎ¶¨ÌïòÏÑ∏Ïöî">
    <title>üåæ ÏòÅÎÜçÏùºÏßÄ</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ÏòÅÎÜçÏùºÏßÄ">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #f0fdf4 0%, #dbeafe 100%);
            min-height: 100vh;
            padding: 1rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .header h1 {
            color: #15803d;
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }
        
        .header p {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        .nav {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .nav button {
            flex: 1;
            padding: 0.75rem;
            border: none;
            border-radius: 0.75rem;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .nav button.active {
            background: #16a34a;
            color: white;
        }
        
        .nav button:not(.active) {
            background: white;
            color: #374151;
        }
        
        .card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .card h3 {
            color: #1f2937;
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }
        
        .mode-switch {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .mode-switch button {
            flex: 1;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .mode-switch button.active {
            background: #16a34a;
            color: white;
        }
        
        .mode-switch button:not(.active) {
            background: #e5e7eb;
            color: #374151;
        }
        
        .mic-container {
            text-align: center;
            padding: 2rem 0;
        }
        
        .mic-button {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: none;
            font-size: 3rem;
            cursor: pointer;
            margin-bottom: 1rem;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            transition: all 0.2s;
        }
        
        .mic-button:hover {
            transform: scale(1.05);
        }
        
        .mic-button.listening {
            background: #dc2626;
            animation: pulse 2s infinite;
        }
        
        .mic-button:not(.listening) {
            background: #16a34a;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .mic-status {
            font-size: 1.2rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        
        .mic-hint {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        textarea {
            width: 100%;
            padding: 1rem;
            border: 2px solid #d1d5db;
            border-radius: 0.75rem;
            font-size: 1rem;
            resize: none;
            font-family: inherit;
            margin-bottom: 1rem;
        }
        
        textarea:focus {
            outline: none;
            border-color: #16a34a;
        }
        
        .btn {
            width: 100%;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.75rem;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: #16a34a;
            color: white;
        }
        
        .btn-primary:hover {
            background: #15803d;
        }
        
        .btn-primary:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        
        .info-box {
            background: #dbeafe;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
        }
        
        .info-box p {
            color: #1e40af;
            font-size: 0.9rem;
        }
        
        .result-box {
            background: #f3f4f6;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .result-label {
            color: #6b7280;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }
        
        .result-value {
            color: #1f2937;
            font-style: italic;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .stat-card {
            padding: 1rem;
            border-radius: 0.5rem;
            border: 2px solid;
        }
        
        .stat-card.green {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-color: #bbf7d0;
        }
        
        .stat-card.blue {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-color: #bfdbfe;
        }
        
        .stat-card.purple {
            background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
            border-color: #e9d5ff;
        }
        
        .record-item {
            border: 2px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.2s;
        }
        
        .record-item:hover {
            border-color: #16a34a;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .record-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 0.75rem;
        }
        
        .record-date {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        .delete-btn {
            background: none;
            border: none;
            color: #ef4444;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0.25rem;
        }
        
        .delete-btn:hover {
            color: #dc2626;
        }
        
        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }
        
        .tag {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .tag.green {
            background: #dcfce7;
            color: #15803d;
        }
        
        .tag.blue {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .tag.purple {
            background: #f3e8ff;
            color: #7c3aed;
        }
        
        .record-text {
            background: #f9fafb;
            padding: 0.75rem;
            border-radius: 0.5rem;
            color: #374151;
            font-style: italic;
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #9ca3af;
        }
        
        .empty-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .summary-card {
            background: linear-gradient(135deg, #16a34a 0%, #2563eb 100%);
            color: white;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .summary-item {
            background: rgba(255,255,255,0.2);
            padding: 1rem;
            border-radius: 0.5rem;
        }
        
        .summary-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 0.25rem;
        }
        
        .summary-value {
            font-size: 2rem;
            font-weight: bold;
        }
        
        .stat-bar-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.75rem;
        }
        
        .stat-label {
            min-width: 80px;
            font-weight: 600;
            color: #374151;
        }
        
        .stat-bar-bg {
            flex: 1;
            background: #e5e7eb;
            height: 32px;
            border-radius: 1rem;
            overflow: hidden;
            position: relative;
        }
        
        .stat-bar {
            height: 100%;
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 0.75rem;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
            transition: width 0.5s ease;
        }
        
        .stat-bar.green {
            background: linear-gradient(90deg, #4ade80 0%, #16a34a 100%);
        }
        
        .stat-bar.blue {
            background: linear-gradient(90deg, #60a5fa 0%, #2563eb 100%);
        }
        
        .stat-bar.purple {
            background: linear-gradient(90deg, #a78bfa 0%, #7c3aed 100%);
        }
        
        #install-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        #install-button {
            background: #16a34a;
            color: white;
            padding: 1rem 1.5rem;
            border: none;
            border-radius: 2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        #install-button:hover {
            background: #15803d;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.25rem;
            }
            
            .mic-button {
                width: 100px;
                height: 100px;
                font-size: 2.5rem;
            }
            
            .summary-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.5rem;
            }
            
            .summary-value {
                font-size: 1.5rem;
            }
            
            .stat-label {
                min-width: 60px;
                font-size: 0.9rem;
            }
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .container {
                max-width: 100%;
            }
            
            .header, .nav, #install-container {
                display: none !important;
            }
            
            .card {
                box-shadow: none;
                padding: 0;
            }
            
            button {
                display: none !important;
            }
            
            table {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div id="install-container" style="display: none;">
        <button id="install-button">üì± Ìôà ÌôîÎ©¥Ïóê Ï∂îÍ∞Ä</button>
    </div>

    <div class="container">
        <div class="header">
            <h1>üåæ ÏùåÏÑ± Í∏∞Î∞ò ÏòÅÎÜçÏùºÏßÄ ÏãúÏä§ÌÖú</h1>
            <p>ÏùåÏÑ±Ïù¥ÎÇò ÌÖçÏä§Ìä∏Î°ú Í∞ÑÌé∏ÌïòÍ≤å ÏòÅÎÜç ÌôúÎèôÏùÑ Í∏∞Î°ùÌïòÏÑ∏Ïöî</p>
        </div>

        <div class="nav">
            <button id="btn-input" class="active" onclick="setView('input')">üìù ÏùºÏßÄ ÏûëÏÑ±</button>
            <button id="btn-list" onclick="setView('list')">üìÖ Î™©Î°ù <span id="record-count">(0)</span></button>
            <button id="btn-stats" onclick="setView('stats')">üìä ÌÜµÍ≥Ñ</button>
            <button id="btn-report" onclick="setView('report')">üìã ÏòÅÎÜçÏùºÏßÄ</button>
        </div>

        <div id="content"></div>
    </div>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(reg => console.log('Service Worker Îì±Î°ù ÏÑ±Í≥µ'))
                    .catch(err => console.log('Service Worker Îì±Î°ù Ïã§Ìå®:', err));
            });
        }

        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('install-container').style.display = 'block';
        });

        document.getElementById('install-button').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                deferredPrompt = null;
                document.getElementById('install-container').style.display = 'none';
            }
        });

        let currentView = 'input';
        let inputMode = 'voice';
        let records = [];
        let currentRecord = null;
        let recognition = null;
        let isListening = false;

        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.lang = 'ko-KR';
                recognition.continuous = false;
                recognition.interimResults = false;

                recognition.onresult = (event) => {
                    const text = event.results[0][0].transcript;
                    document.getElementById('input-text').value = text;
                    analyzeText(text);
                };

                recognition.onerror = (event) => {
                    isListening = false;
                    updateMicButton();
                    if (event.error === 'not-allowed') {
                        alert('ÎßàÏù¥ÌÅ¨ Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                    } else if (event.error === 'no-speech') {
                        alert('ÏùåÏÑ±Ïù¥ Í∞êÏßÄÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                    }
                };

                recognition.onend = () => {
                    isListening = false;
                    updateMicButton();
                };

                recognition.onstart = () => {
                    isListening = true;
                    updateMicButton();
                };

                return true;
            }
            return false;
        }

        function analyzeText(text) {
            const crops = [
                'Ìè¨ÎèÑ', 'ÏÇ¨Í≥º', 'Î∞∞', 'Îî∏Í∏∞', 'Î≥µÏà≠ÏïÑ', 'ÏûêÎëê', 'Í∞ê', 'Î∞§', 'ÎåÄÏ∂î', 'Îß§Ïã§', 'ÏÇ¥Íµ¨', 'ÏïµÎëê', 
                'Í∞êÍ∑§', 'Í∑§', 'ÌïúÎùºÎ¥â', 'Ï≤úÌòúÌñ•', 'Î†àÎìúÌñ•', 'Î∏îÎ£®Î≤†Î¶¨', 'ÌÇ§ÏúÑ', 'Î¨¥ÌôîÍ≥º', 'ÏÑùÎ•ò', 'Ïò§Îîî',
                'ÌÜ†ÎßàÌÜ†', 'Ïò§Ïù¥', 'Í≥†Ï∂î', 'ÏÉÅÏ∂î', 'Î∞∞Ï∂î', 'Î¨¥', 'ÎãπÍ∑º', 'ÏñëÌåå', 'ÎßàÎäò', 'Ìåå', 'Ï™ΩÌåå', 'ÎåÄÌåå',
                'ÏãúÍ∏àÏπò', 'ÍπªÏûé', 'Ìò∏Î∞ï', 'Í∞ÄÏßÄ', 'ÌîºÎßù', 'ÌååÌîÑÎ¶¨Ïπ¥', 'Î∏åÎ°úÏΩúÎ¶¨', 'ÏñëÎ∞∞Ï∂î', 'ÏΩ©', 'ÏôÑÎëêÏΩ©',
                'Í∞ïÎÇ≠ÏΩ©', 'Ïò•ÏàòÏàò', 'Í∞êÏûê', 'Í≥†Íµ¨Îßà', 'ÏÉùÍ∞ï', 'Ïö∞Ïóâ', 'Ïó∞Í∑º', 'Ïó¥Î¨¥', 'Í∞ì', 'Ïë•Í∞ì',
                'Î≤º', 'ÏåÄ', 'Î≥¥Î¶¨', 'Î∞Ä', 'Ìå•', 'ÎÖπÎëê', 'ÏàòÏàò', 'Ï°∞', 'Í∏∞Ïû•',
                'Ï∞∏Íπ®', 'Îì§Íπ®', 'ÎïÖÏΩ©', 'Í≥†Íµ¨ÎßàÏàú', 'ÎçîÎçï', 'ÎèÑÎùºÏßÄ', 'Ïù∏ÏÇº', 'ÏàòÏÇº', 'Î≤ÑÏÑØ'
            ];

            const taskCategories = {
                'Í∏∞Î≥∏ÏûëÏóÖ': ['Í≤ΩÏö¥', 'ÎÖºÍ∞àÏù¥', 'Î∞≠Í∞àÏù¥', 'Î°úÌÉÄÎ¶¨', 'Ïç®Î†àÏßà', 'Ïù¥Ïïô', 'Î™®ÎÇ¥Í∏∞', 'ÏãúÎπÑ', 'Î∞ëÍ±∞Î¶Ñ', 'ÏõÉÍ±∞Î¶Ñ', 'ÏàòÌôï', 'Îî∞Í∏∞', 'Î≤†Í∏∞', 'Ï∫êÍ∏∞'],
                'Î∞©Ï†úÏûëÏóÖ': ['Î∞©Ï†ú', 'ÏïΩÏπòÍ∏∞', 'ÏÇ¥Ìè¨', 'Î∂ÑÎ¨¥', 'Î≥ëÌï¥Ï∂©Î∞©Ï†ú', 'ÏÜåÎèÖ', 'Î∞©Ïó≠', 'ÎÜçÏïΩÏÇ¥Ìè¨', 'ÏòàÎ∞©'],
                'Ïú°Î¨òÏûëÏóÖ': ['ÌååÏ¢Ö', 'Ïî®ÎøåÎ¶¨Í∏∞', 'Ïú°Î¨ò', 'Î™®Í∏∞Î•¥Í∏∞', 'ÏÜåÎèÖ', 'Ï∂úÌïò'],
                'Í¥ÄÎ¶¨ÏûëÏóÖ': ['Î¨ºÏ£ºÍ∏∞', 'Í¥ÄÏàò', 'Î¨ºÎåÄÍ∏∞', 'Ï†úÏ¥à', 'ÌíÄÎΩëÍ∏∞', 'ÍπÄÎß§Í∏∞', 'Ï†ÑÏ†ï', 'Í∞ÄÏßÄÏπòÍ∏∞', 'ÏàúÏßÄÎ•¥Í∏∞', 'Ï†ÅÏã¨', 'ÏàúÎî∞Í∏∞']
            };

            const allTasks = [
                'ÌååÏ¢Ö', 'Ïî®ÎøåÎ¶¨Í∏∞', 'Ïî®ÎøåÎ¶º', 'ÎøåÎ†∏', 'Ïã¨Í∏∞', 'Ïã¨Ïóà', 'Î™®ÎÇ¥Í∏∞', 'Ïù¥Ïïô', 'Ï†ïÏãù', 'ÏòÆÍ≤®Ïã¨Í∏∞',
                'Ïú°Î¨ò', 'Î™®Í∏∞Î•¥Í∏∞', 'ÏïÑÏ£ºÏã¨Í∏∞', 'Î≥∏Î∞≠Ïã¨Í∏∞',
                'Í¥ÄÏàò', 'Î¨ºÏ£ºÍ∏∞', 'Î¨ºÏ£ºÏóà', 'Î¨ºÏ§¨', 'Î¨ºÎåÄÍ∏∞', 'Î¨ºÎåî', 'Î¨ºÎπºÍ∏∞', 'Î¨ºÎ∫ê',
                'Ï§ëÍ∞ÑÎ¨ºÎñºÍ∏∞', 'Î¨ºÎñºÍ∏∞', 'ÎÖºÍ∞àÏù¥', 'Î∞≠Í∞àÏù¥', 'Í≤ΩÏö¥', 'Î°úÌÉÄÎ¶¨', 'Ïç®Î†àÏßà', 'ÎëêÎëëÎßåÎì§Í∏∞',
                'ÏãúÎπÑ', 'ÎπÑÎ£åÏ£ºÍ∏∞', 'Î∞ëÍ±∞Î¶Ñ', 'ÏõÉÍ±∞Î¶Ñ', 'Ï∂îÎπÑ', 'Í±∞Î¶ÑÏ£ºÍ∏∞', 'Ìá¥ÎπÑ', 'Ìá¥ÎπÑÏ£ºÍ∏∞',
                'Í∏∞ÎπÑ', 'Ïï°ÎπÑ', 'ÏóΩÎ©¥ÏãúÎπÑ', 'ÏòÅÏñëÏ†ú', 'ÏπºÏäòÏ†ú', 'Ï≤†Î∂ÑÏ†ú',
                'Î∞©Ï†ú', 'ÏïΩÏπòÍ∏∞', 'ÏïΩÏ≥§', 'ÏÇ¥Ìè¨', 'Î∂ÑÎ¨¥', 'Î≥ëÌï¥Ï∂©Î∞©Ï†ú', 'ÏòàÎ∞©', 'ÏÜåÎèÖ', 'Î∞©Ïó≠',
                'ÎÜçÏïΩÏÇ¥Ìè¨', 'ÏÇ¥Ï∂©Ï†ú', 'ÏÇ¥Í∑†Ï†ú', 'Ï†úÏ¥àÏ†ú', 'ÎÜçÏïΩ',
                'Ï†úÏ¥à', 'ÌíÄÎΩëÍ∏∞', 'ÌíÄÎΩëÏïò', 'ÍπÄÎß§Í∏∞', 'ÍπÄÎß∏', 'Ï†úÏ¥àÏûëÏóÖ', 'Ïû°Ï¥àÏ†úÍ±∞', 'Îß§Í∏∞',
                'Ï†ÑÏ†ï', 'Í∞ÄÏßÄÏπòÍ∏∞', 'ÏàúÏßÄÎ•¥Í∏∞', 'Ï†ÅÏã¨', 'ÏàúÎî∞Í∏∞', 'ÏàúÏπòÍ∏∞', 'Ï†ÅÍ≥º', 'Ï†ÅÌôî',
                'ÏÜéÏïÑÎÇ¥Í∏∞', 'ÎçßÍ±∞Î¶Ñ', 'Ïàú Ï†ïÎ¶¨', 'Í≥ÅÏàúÏ†úÍ±∞', 'Í≥ÅÍ∞ÄÏßÄÏ†úÍ±∞', 'ÏÜêÏßà',
                'ÏàòÌôï', 'ÏàòÌôïÌñà', 'Îî∞Í∏∞', 'ÎïÑ', 'Î≤†Í∏∞', 'Î≤¥', 'Ï∫êÍ∏∞', 'Ï∫§', 'Í±∞ÎëêÍ∏∞', 'Í±∞ÎíÄ',
                'Îî∞ÎÇ¥Í∏∞', 'ÎΩëÍ∏∞', 'ÎΩëÏïò', 'ÏàòÌôïÏûëÏóÖ', 'Ï∂úÌïò', 'Ìè¨Ïû•',
                'ÏßÄÏ£ºÏÑ∏Ïö∞Í∏∞', 'Ïú†Ïù∏', 'ÏßÄÏ£ºÏÑ§Ïπò', 'ÎçÆÍ∞ú', 'Î©ÄÏπ≠', 'ÎπÑÎãêÏîåÏö∞Í∏∞', 'ÌïòÏö∞Ïä§Í¥ÄÎ¶¨',
                'ÌôòÍ∏∞', 'Ïò®ÎèÑÍ¥ÄÎ¶¨', 'ÏäµÎèÑÏ°∞Ï†à', 'Î≥¥Ïò®', 'ÎÇúÎ∞©', 'ÎÉâÎ∞©', 'Ï∞®Í¥ë', 'ÎπÑÍ∞ÄÎ¶º',
                'ÏàúÏπòÍ∏∞', 'Ïàú Ï†ïÎ¶¨', 'ÍΩÉÏÜéÍ∏∞', 'Ïó¥Îß§ÏÜéÍ∏∞', 'Î¥âÏßÄÏîåÏö∞Í∏∞', 'Ï†ÅÍ≥ºÏûëÏóÖ'
            ];

            const allMaterials = [
                'ÎπÑÎ£å', 'Î≥µÌï©ÎπÑÎ£å', 'ÏöîÏÜå', 'Ïú†Í∏∞ÏßàÎπÑÎ£å', 'Ìá¥ÎπÑ', 'Í≥ÑÎ∂Ñ', 'ÎèàÎ∂Ñ', 'Ïö∞Î∂Ñ', 'ÎÖπÎπÑ',
                'ÏßàÏÜåÎπÑÎ£å', 'Ïù∏ÏÇ∞ÎπÑÎ£å', 'ÏπºÎ¶¨ÎπÑÎ£å', 'NPK', 'Î∂ïÏÜå', 'ÏπºÏäò', 'Í≥†ÌÜ†ÏÑùÌöå', 'ÏÑùÌöå',
                'ÎØ∏ÎüâÏöîÏÜå', 'Í∑úÏÇ∞', 'Ìô©ÏÇ∞Í∞ÄÎ¶¨', 'ÏóºÌôîÍ∞ÄÎ¶¨', 'Í≥ºÎ¶∞ÏÇ∞ÏÑùÌöå', 'Ïö©ÏÑ±Ïù∏ÎπÑ',
                'ÏòÅÏñëÏ†ú', 'ÌôúÎ†•Ï†ú', 'Î∞úÍ∑ºÏ¥âÏßÑÏ†ú', 'Í∞úÌôîÏ¥âÏßÑÏ†ú', 'Ï∞©Í≥ºÏ¥âÏßÑÏ†ú', 'ÏÉùÏû•Ï°∞Ï†àÏ†ú',
                'ÏïÑÎØ∏ÎÖ∏ÏÇ∞', 'ÏπºÏäòÏ†ú', 'Ï≤†Î∂ÑÏ†ú', 'ÏóΩÎ©¥ÏãúÎπÑÏ†ú', 'Ïï°ÎπÑ', 'ÎØ∏ÏÉùÎ¨ºÏ†ú',
                'ÎÜçÏïΩ', 'ÏÇ¥Ï∂©Ï†ú', 'ÏÇ¥Í∑†Ï†ú', 'Ï†úÏ¥àÏ†ú', 'ÏÇ¥ÎπÑÏ†ú', 'ÏÇ¥ÏÑ†Ï∂©Ï†ú',
                'Ï†ÑÏ∞©Ï†ú', 'ÏπúÌôòÍ≤ΩÎÜçÏïΩ', 'Ïú†Í∏∞ÎÜçÏûêÏû¨', 'ÎØ∏ÏÉùÎ¨ºÎÜçÏïΩ', 'Ìï¥Ï∂©Î∞©Ï†úÏ†ú',
                'Î¨º', 'Í±∞Î¶Ñ', 'Î≥èÏßö', 'ÏôïÍ≤®', 'ÌÜ±Î∞•', 'Î∂ÄÏßÅÌè¨', 'Î©ÄÏπ≠ÎπÑÎãê', 'ÏßÄÏ£ºÎåÄ',
                'ÎÅà', 'Ï≤†ÏÇ¨', 'Í∑∏Î¨ºÎßù', 'Ï∞®Í¥ëÎßù', 'Î∞©ÌíçÎßù', 'Î≥¥Ïò®ÎçÆÍ∞ú', 'ÌùëÏÉâÎπÑÎãê',
                'Ìà¨Î™ÖÎπÑÎãê', 'Ïßö', 'ÏùÄÎ∞ïÎ©ÄÏπ≠', 'ÏÉùÎ∂ÑÌï¥Î©ÄÏπ≠'
            ];

            let detectedCrop = '';
            let detectedTask = '';
            let detectedMaterial = '';
            let workCategory = '';

            crops.forEach(crop => {
                if (text.includes(crop)) detectedCrop = crop;
            });

            allTasks.forEach(task => {
                if (text.includes(task)) {
                    detectedTask = task;
                    for (const [category, tasks] of Object.entries(taskCategories)) {
                        if (tasks.includes(task)) {
                            workCategory = category;
                            break;
                        }
                    }
                    if (!workCategory) workCategory = 'Í¥ÄÎ¶¨ÏûëÏóÖ';
                }
            });

            allMaterials.forEach(material => {
                if (text.includes(material)) detectedMaterial = material;
            });

            currentRecord = {
                id: Date.now(),
                date: new Date().toLocaleString('ko-KR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                }),
                rawText: text,
                crop: detectedCrop || 'ÎØ∏Î∂ÑÎ•ò',
                task: detectedTask || 'ÎØ∏Î∂ÑÎ•ò',
                material: detectedMaterial || 'ÎØ∏ÏÇ¨Ïö©',
                workCategory: workCategory || 'Í∏∞ÌÉÄÏûëÏóÖ',
                timestamp: Date.now()
            };

            renderInputView();
        }

        function toggleListening() {
            if (!recognition) {
                alert('Ïù¥ Î∏åÎùºÏö∞Ï†ÄÎäî ÏùåÏÑ± Ïù∏ÏãùÏùÑ ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.');
                return;
            }

            if (isListening) {
                recognition.stop();
            } else {
                document.getElementById('input-text').value = '';
                currentRecord = null;
                try {
                    recognition.start();
                } catch (error) {
                    alert('ÏùåÏÑ± Ïù∏ÏãùÏùÑ ÏãúÏûëÌï† Ïàò ÏóÜÏäµÎãàÎã§.');
                }
            }
        }

        function updateMicButton() {
            const btn = document.getElementById('mic-button');
            const status = document.getElementById('mic-status');
            if (btn && status) {
                if (isListening) {
                    btn.className = 'mic-button listening';
                    btn.innerHTML = 'üî¥';
                    status.textContent = 'üî¥ Îì£Í≥† ÏûàÏäµÎãàÎã§...';
                } else {
                    btn.className = 'mic-button';
                    btn.innerHTML = 'üé§';
                    status.textContent = 'ÎßàÏù¥ÌÅ¨ Î≤ÑÌäºÏùÑ ÎàåÎü¨ ÎßêÏîÄÌïòÏÑ∏Ïöî';
                }
            }
        }

        function handleTextSubmit() {
            const text = document.getElementById('input-text').value.trim();
            if (text) {
                analyzeText(text);
            }
        }

        function saveRecord() {
            if (currentRecord) {
                records.unshift(currentRecord);
                localStorage.setItem('farmRecords', JSON.stringify(records));
                currentRecord = null;
                document.getElementById('input-text').value = '';
                alert('ÏòÅÎÜçÏùºÏßÄÍ∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§! üìù');
                renderInputView();
                updateRecordCount();
            }
        }

        function deleteRecord(id) {
            if (confirm('Ïù¥ Í∏∞Î°ùÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                records = records.filter(r => r.id !== id);
                localStorage.setItem('farmRecords', JSON.stringify(records));
                renderListView();
                updateRecordCount();
            }
        }

        function updateRecordCount() {
            document.getElementById('record-count').textContent = `(${records.length})`;
        }

        function getStats() {
            const cropCount = {};
            const taskCount = {};
            const materialCount = {};

            records.forEach(record => {
                cropCount[record.crop] = (cropCount[record.crop] || 0) + 1;
                taskCount[record.task] = (taskCount[record.task] || 0) + 1;
                if (record.material !== 'ÎØ∏ÏÇ¨Ïö©') {
                    materialCount[record.material] = (materialCount[record.material] || 0) + 1;
                }
            });

            return { cropCount, taskCount, materialCount };
        }

        function setView(view) {
            currentView = view;
            document.getElementById('btn-input').className = view === 'input' ? 'active' : '';
            document.getElementById('btn-list').className = view === 'list' ? 'active' : '';
            document.getElementById('btn-stats').className = view === 'stats' ? 'active' : '';
            document.getElementById('btn-report').className = view === 'report' ? 'active' : '';

            if (view === 'input') renderInputView();
            else if (view === 'list') renderListView();
            else if (view === 'stats') renderStatsView();
            else if (view === 'report') renderReportView();
        }

        function setInputMode(mode) {
            inputMode = mode;
            renderInputView();
        }

        function renderInputView() {
            const inputText = document.getElementById('input-text')?.value || '';
            
            let html = '<div class="card">';
            html += '<div class="mode-switch">';
            html += `<button class="${inputMode === 'voice' ? 'active' : ''}" onclick="setInputMode('voice')">üé§ ÏùåÏÑ± ÏûÖÎ†•</button>`;
            html += `<button class="${inputMode === 'text' ? 'active' : ''}" onclick="setInputMode('text')">‚å®Ô∏è ÌÖçÏä§Ìä∏ ÏûÖÎ†•</button>`;
            html += '</div>';

            if (inputMode === 'voice') {
                html += '<h3>üé§ ÏùåÏÑ±ÏúºÎ°ú ÎßêÏîÄÌï¥Ï£ºÏÑ∏Ïöî</h3>';
                html += '<div class="mic-container">';
                html += '<button id="mic-button" class="mic-button" onclick="toggleListening()">üé§</button>';
                html += '<p id="mic-status" class="mic-status">ÎßàÏù¥ÌÅ¨ Î≤ÑÌäºÏùÑ ÎàåÎü¨ ÎßêÏîÄÌïòÏÑ∏Ïöî</p>';
                html += '<p class="mic-hint">Ïòà: "Ìè¨ÎèÑÏóê ÏòÅÏñëÏ†ú ÏÇ¥Ìè¨ÌñàÏñ¥"</p>';
                html += '</div>';
                html += `<input type="text" id="input-text" value="${inputText}" style="display:none;">`;
            } else {
                html += '<h3>üìù ÏòÅÎÜç ÌôúÎèô ÏûÖÎ†•</h3>';
                html += `<textarea id="input-text" placeholder='Ïòà: "Ìè¨ÎèÑÏóê ÏòÅÏñëÏ†ú ÏÇ¥Ìè¨ÌñàÏñ¥", "ÌÜ†ÎßàÌÜ† ÏàòÌôïÌñàÏñ¥"' rows="4">${inputText}</textarea>`;
                html += '<button class="btn btn-primary" onclick="handleTextSubmit()">üì® Î∂ÑÏÑùÌïòÍ∏∞</button>';
            }

            html += '<div class="info-box">';
            html += '<p>üí° <strong>ÏûÖÎ†• ÏòàÏãú:</strong> "Ìè¨ÎèÑÏóê ÏòÅÏñëÏ†ú ÏÇ¥Ìè¨ÌñàÏñ¥", "ÏÇ¨Í≥º ÏàòÌôïÌñàÏñ¥"</p>';
            html += '</div></div>';

            if (inputText && inputMode === 'voice') {
                html += '<div class="card">';
                html += '<h3>üé§ Ïù∏ÏãùÎêú ÏùåÏÑ±</h3>';
                html += `<p style="font-size: 1.1rem; color: #374151;">${inputText}</p>`;
                html += '</div>';
            }

            if (currentRecord) {
                html += '<div class="card">';
                html += '<h3><span style="font-size: 1.5rem;">‚úÖ</span> ÏûêÎèô ÏÉùÏÑ±Îêú ÏòÅÎÜçÏùºÏßÄ</h3>';
                html += '<div class="result-box">';
                html += '<p class="result-label">ÏûÖÎ†•Ìïú ÎÇ¥Ïö©</p>';
                html += `<p class="result-value">"${currentRecord.rawText}"</p>`;
                html += '</div>';
                html += '<div class="grid">';
                html += '<div class="stat-card green">';
                html += '<p class="result-label">üìÖ ÎÇ†Ïßú/ÏãúÍ∞Ñ</p>';
                html += `<p style="font-weight: 600; color: #1f2937;">${currentRecord.date}</p>`;
                html += '</div>';
                html += '<div class="stat-card green">';
                html += '<p class="result-label">üå± ÏûëÎ¨º</p>';
                html += `<p style="font-weight: 600; color: #15803d; font-size: 1.2rem;">${currentRecord.crop}</p>`;
                html += '</div>';
                html += '<div class="stat-card blue">';
                html += '<p class="result-label">üîß ÏûëÏóÖ</p>';
                html += `<p style="font-weight: 600; color: #1e40af; font-size: 1.2rem;">${currentRecord.task}</p>`;
                html += '</div>';
                html += '<div class="stat-card purple">';
                html += '<p class="result-label">üíä ÏûêÏû¨</p>';
                html += `<p style="font-weight: 600; color: #7c3aed; font-size: 1.2rem;">${currentRecord.material}</p>`;
                html += '</div>';
                html += '</div>';
                html += '<button class="btn btn-primary" onclick="saveRecord()" style="font-size: 1.1rem;">üíæ ÏòÅÎÜçÏùºÏßÄ Ï†ÄÏû•ÌïòÍ∏∞</button>';
                html += '</div>';
            }

            document.getElementById('content').innerHTML = html;
        }

        function renderListView() {
            let html = '<div class="card">';
            html += '<h3>üìÖ ÏòÅÎÜçÏùºÏßÄ Î™©Î°ù</h3>';

            if (records.length === 0) {
                html += '<div class="empty-state">';
                html += '<div class="empty-icon">üì≠</div>';
                html += '<p>ÏïÑÏßÅ Í∏∞Î°ùÎêú ÏòÅÎÜçÏùºÏßÄÍ∞Ä ÏóÜÏäµÎãàÎã§.</p>';
                html += '<p style="font-size: 0.9rem; margin-top: 0.5rem;">ÏùºÏßÄ ÏûëÏÑ± ÌÉ≠ÏóêÏÑú Ï≤´ Í∏∞Î°ùÏùÑ ÎÇ®Í≤®Î≥¥ÏÑ∏Ïöî!</p>';
                html += '</div>';
            } else {
                html += '<div style="margin-bottom: 2rem;">';
                html += '<button onclick="toggleReportView()" class="btn btn-primary" style="width: auto; margin-bottom: 1rem;">üìä ÏûëÏóÖ Ïú†ÌòïÎ≥Ñ Î≥¥Í≥†ÏÑú Î≥¥Í∏∞</button>';
                html += '<div id="report-view" style="display: none;"></div>';
                html += '</div>';

                records.forEach(record => {
                    html += '<div class="record-item">';
                    html += '<div class="record-header">';
                    html += `<div><span class="record-date">${record.date}</span>`;
                    if (record.workCategory && record.workCategory !== 'ÎØ∏ÏÇ¨Ïö©') {
                        html += `<span class="tag" style="background: #fef3c7; color: #92400e; margin-left: 0.5rem;">${record.workCategory}</span>`;
                    }
                    html += `</div>`;
                    html += `<button class="delete-btn" onclick="deleteRecord(${record.id})">üóëÔ∏è</button>`;
                    html += '</div>';
                    html += '<div class="tags">';
                    html += `<span class="tag green">üå± ${record.crop}</span>`;
                    html += `<span class="tag blue">üîß ${record.task}</span>`;
                    if (record.material !== 'ÎØ∏ÏÇ¨Ïö©') {
                        html += `<span class="tag purple">üíä ${record.material}</span>`;
                    }
                    html += '</div>';
                    html += `<div class="record-text">"${record.rawText}"</div>`;
                    html += '</div>';
                });
            }

            html += '</div>';
            document.getElementById('content').innerHTML = html;
        }

        function toggleReportView() {
            const reportDiv = document.getElementById('report-view');
            if (reportDiv.style.display === 'none') {
                reportDiv.style.display = 'block';
                generateReport();
            } else {
                reportDiv.style.display = 'none';
            }
        }

        function generateReport() {
            const basicWork = records.filter(r => r.workCategory === 'Í∏∞Î≥∏ÏûëÏóÖ');
            const pestControl = records.filter(r => r.workCategory === 'Î∞©Ï†úÏûëÏóÖ');
            const seedling = records.filter(r => r.workCategory === 'Ïú°Î¨òÏûëÏóÖ');
            const management = records.filter(r => r.workCategory === 'Í¥ÄÎ¶¨ÏûëÏóÖ');
            const others = records.filter(r => !['Í∏∞Î≥∏ÏûëÏóÖ', 'Î∞©Ï†úÏûëÏóÖ', 'Ïú°Î¨òÏûëÏóÖ', 'Í¥ÄÎ¶¨ÏûëÏóÖ'].includes(r.workCategory));

            let html = '<div style="background: #f9fafb; padding: 1.5rem; border-radius: 1rem; border: 2px solid #e5e7eb;">';
            html += '<h3 style="color: #1f2937; margin-bottom: 1rem;">üìã ÏûëÏóÖ Ïú†ÌòïÎ≥Ñ ÏòÅÎÜçÏùºÏßÄ Î≥¥Í≥†ÏÑú</h3>';

            if (basicWork.length > 0) {
                html += '<div style="background: white; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">';
                html += '<h4 style="color: #16a34a; margin-bottom: 0.75rem;">üöú Í∏∞Î≥∏ ÎÜçÏûëÏóÖ (Í≤ΩÏö¥/Ïù¥Ïïô/ÏãúÎπÑ/ÏàòÌôï)</h4>';
                html += '<table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">';
                html += '<thead><tr style="background: #f3f4f6;"><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ÎÇ†Ïßú</th><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ÏûëÎ¨º</th><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ÏûëÏóÖ</th><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ÏûêÏû¨</th></tr></thead>';
                html += '<tbody>';
                basicWork.forEach(r => {
                    html += `<tr><td style="padding: 0.5rem; border: 1px solid #d1d5db;">${r.date}</td><td style="padding: 0.5rem; border: 1px solid #d1d5db;">${r.crop}</td><td style="padding: 0.5rem; border: 1px solid #d1d5db;">${r.task}</td><td style="padding: 0.5rem; border: 1px solid #d1d5db;">${r.material}</td></tr>`;
                });
                html += '</tbody></table></div>';
            }

            if (pestControl.length > 0) {
                html += '<div style="background: white; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">';
                html += '<h4 style="color: #dc2626; margin-bottom: 0.75rem;">üíä Î∞©Ï†úÏûëÏóÖ (ÎÜçÏïΩ/ÏòÅÏñëÏ†ú ÏÇ¥Ìè¨)</h4>';
                html += '<table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">';
                html += '<thead><tr style="background: #f3f4f6;"><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ÎÇ†Ïßú</th><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ÏûëÎ¨º</th><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ÏûëÏóÖ</th><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ÏûêÏû¨</th></tr></thead>';
                html += '<tbody>';
                pestControl.forEach(r => {
                    html += `<tr><td style="padding: 0.5rem; border: 1px solid #d1d5db;">${r.date}</td><td style="padding: 0.5rem; border: 1px solid #d1d5db;">${r.crop}</td><td style="padding: 0.5rem; border: 1px solid #d1d5db;">${r.task}</td><td style="padding: 0.5rem; border: 1px solid #d1d5db;">${r.material}</td></tr>`;
                });
                html += '</tbody></table></div>';
            }

            if (seedling.length > 0) {
                html += '<div style="background: white; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">';
                html += '<h4 style="color: #2563eb; margin-bottom: 0.75rem;">üå± Ïú°Î¨òÏûëÏóÖ (ÌååÏ¢Ö/ÏÜåÎèÖ/Ï∂úÌïò)</h4>';
                html += '<table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">';
                html += '<thead><tr style="background: #f3f4f6;"><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ÎÇ†Ïßú</th><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ÏûëÎ¨º</th><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ÏûëÏóÖ</th><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ÎπÑÍ≥†</th></tr></thead>';
                html += '<tbody>';
                seedling.forEach(r => {
                    html += `<tr><td style="padding: 0.5rem; border: 1px solid #d1d5db;">${r.date}</td><td style="padding: 0.5rem; border: 1px solid #d1d5db;">${r.crop}</td><td style="padding: 0.5rem; border: 1px solid #d1d5db;">${r.task}</td><td style="padding: 0.5rem; border: 1px solid #d1d5db;">${r.material}</td></tr>`;
                });
                html += '</tbody></table></div>';
            }

            if (management.length > 0) {
                html += '<div style="background: white; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">';
                html += '<h4 style="color: #7c3aed; margin-bottom: 0.75rem;">üîß ÏùºÏÉÅ Í¥ÄÎ¶¨ÏûëÏóÖ</h4>';
                html += '<table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">';
                html += '<thead><tr style="background: #f3f4f6;"><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ÎÇ†Ïßú</th><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ÏûëÎ¨º</th><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ÏûëÏóÖ</th><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ÎÇ¥Ïö©</th></tr></thead>';
                html += '<tbody>';
                management.forEach(r => {
                    html += `<tr><td style="padding: 0.5rem; border: 1px solid #d1d5db;">${r.date}</td><td style="padding: 0.5rem; border: 1px solid #d1d5db;">${r.crop}</td><td style="padding: 0.5rem; border: 1px solid #d1d5db;">${r.task}</td><td style="padding: 0.5rem; border: 1px solid #d1d5db; font-size: 0.85rem;">${r.rawText}</td></tr>`;
                });
                html += '</tbody></table></div>';
            }

            html += '<div style="background: linear-gradient(135deg, #16a34a 0%, #2563eb 100%); padding: 1rem; border-radius: 0.5rem; color: white;">';
            html += '<h4 style="margin-bottom: 0.5rem;">üìä ÏûëÏóÖ ÏöîÏïΩ</h4>';
            html += `<p>Í∏∞Î≥∏ÏûëÏóÖ: ${basicWork.length}Í±¥ | Î∞©Ï†úÏûëÏóÖ: ${pestControl.length}Í±¥ | Ïú°Î¨òÏûëÏóÖ: ${seedling.length}Í±¥ | Í¥ÄÎ¶¨ÏûëÏóÖ: ${management.length}Í±¥ | Í∏∞ÌÉÄ: ${others.length}Í±¥</p>`;
            html += '</div></div>';

            document.getElementById('report-view').innerHTML = html;
        }

        function renderStatsView() {
            const stats = getStats();
            let html = '<div>';

            if (records.length === 0) {
                html += '<div class="card"><div class="empty-state">';
                html += '<div class="empty-icon">üìä</div>';
                html += '<p>ÌÜµÍ≥ÑÎ•º Î≥¥Î†§Î©¥ Î®ºÏ†Ä ÏòÅÎÜçÏùºÏßÄÎ•º ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî!</p>';
                html += '</div></div>';
            } else {
                html += '<div class="summary-card">';
                html += '<h3>üìà Ï†ÑÏ≤¥ ÏöîÏïΩ</h3>';
                html += '<div class="summary-grid">';
                html += '<div class="summary-item">';
                html += '<p class="summary-label">Ï¥ù Í∏∞Î°ù</p>';
                html += `<p class="summary-value">${records.length}Í±¥</p>`;
                html += '</div>';
                html += '<div class="summary-item">';
                html += '<p class="summary-label">Í¥ÄÎ¶¨ ÏûëÎ¨º</p>';
                html += `<p class="summary-value">${Object.keys(stats.cropCount).length}Ï¢Ö</p>`;
                html += '</div>';
                html += '<div class="summary-item">';
                html += '<p class="summary-label">ÏàòÌñâ ÏûëÏóÖ</p>';
                html += `<p class="summary-value">${Object.keys(stats.taskCount).length}Ï¢Ö</p>`;
                html += '</div>';
                html += '</div></div>';

                html += '<div class="card">';
                html += '<h3>üå± ÏûëÎ¨ºÎ≥Ñ Í¥ÄÎ¶¨ ÌòÑÌô©</h3>';
                Object.entries(stats.cropCount)
                    .sort((a, b) => b[1] - a[1])
                    .forEach(([crop, count]) => {
                        const percentage = Math.max((count / records.length) * 100, 15);
                        html += '<div class="stat-bar-container">';
                        html += `<div class="stat-label">${crop}</div>`;
                        html += '<div class="stat-bar-bg">';
                        html += `<div class="stat-bar green" style="width: ${percentage}%">${count}Í±¥</div>`;
                        html += '</div></div>';
                    });
                html += '</div>';

                html += '<div class="card">';
                html += '<h3>üîß ÏûëÏóÖ Ïú†Ìòï Î∂ÑÏÑù</h3>';
                Object.entries(stats.taskCount)
                    .sort((a, b) => b[1] - a[1])
                    .forEach(([task, count]) => {
                        const percentage = Math.max((count / records.length) * 100, 15);
                        html += '<div class="stat-bar-container">';
                        html += `<div class="stat-label">${task}</div>`;
                        html += '<div class="stat-bar-bg">';
                        html += `<div class="stat-bar blue" style="width: ${percentage}%">${count}Í±¥</div>`;
                        html += '</div></div>';
                    });
                html += '</div>';

                if (Object.keys(stats.materialCount).length > 0) {
                    html += '<div class="card">';
                    html += '<h3>üíä ÏûêÏû¨ ÏÇ¨Ïö© ÌòÑÌô©</h3>';
                    Object.entries(stats.materialCount)
                        .sort((a, b) => b[1] - a[1])
                        .forEach(([material, count]) => {
                            const percentage = Math.max((count / records.length) * 100, 15);
                            html += '<div class="stat-bar-container">';
                            html += `<div class="stat-label">${material}</div>`;
                            html += '<div class="stat-bar-bg">';
                            html += `<div class="stat-bar purple" style="width: ${percentage}%">${count}Í±¥</div>`;
                            html += '</div></div>';
                        });
                    html += '</div>';
                }
            }

            html += '</div>';
            document.getElementById('content').innerHTML = html;
        }

        function renderReportView() {
            let html = '<div class="card">';
            html += '<h3>üìã ÏòÅÎÜçÏùºÏßÄ Ï∂úÎ†•</h3>';

            if (records.length === 0) {
                html += '<div class="empty-state">';
                html += '<div class="empty-icon">üìã</div>';
                html += '<p>Í∏∞Î°ùÏù¥ ÏóÜÏñ¥ÏÑú ÏòÅÎÜçÏùºÏßÄÎ•º ÏÉùÏÑ±Ìï† Ïàò ÏóÜÏäµÎãàÎã§.</p>';
                html += '</div></div>';
                document.getElementById('content').innerHTML = html;
                return;
            }

            // ÏõîÎ≥ÑÎ°ú Í∑∏Î£πÌôî
            const monthlyData = {};
            records.forEach(record => {
                const date = new Date(record.timestamp);
                const yearMonth = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                if (!monthlyData[yearMonth]) {
                    monthlyData[yearMonth] = [];
                }
                monthlyData[yearMonth].push(record);
            });

            // Ïõî ÏÑ†ÌÉù ÎìúÎ°≠Îã§Ïö¥
            html += '<div style="margin-bottom: 1.5rem;">';
            html += '<label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">Ï°∞ÌöåÌï† Ïõî ÏÑ†ÌÉù:</label>';
            html += '<select id="month-select" onchange="generateMonthlyReport()" style="width: 100%; padding: 0.75rem; border: 2px solid #d1d5db; border-radius: 0.5rem; font-size: 1rem;">';
            html += '<option value="">-- Ïõî ÏÑ†ÌÉù --</option>';
            Object.keys(monthlyData).sort().reverse().forEach(month => {
                const [year, m] = month.split('-');
                html += `<option value="${month}">${year}ÎÖÑ ${parseInt(m)}Ïõî</option>`;
            });
            html += '</select></div>';

            html += '<div id="monthly-report-container"></div>';
            html += '</div>';

            document.getElementById('content').innerHTML = html;
        }

        function generateMonthlyReport() {
            const selectedMonth = document.getElementById('month-select').value;
            if (!selectedMonth) {
                document.getElementById('monthly-report-container').innerHTML = '';
                return;
            }

            const monthRecords = records.filter(record => {
                const date = new Date(record.timestamp);
                const yearMonth = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                return yearMonth === selectedMonth;
            });

            // ÎÇ†ÏßúÎ≥ÑÎ°ú Í∑∏Î£πÌôî
            const dailyData = {};
            monthRecords.forEach(record => {
                const date = new Date(record.timestamp);
                const dateKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
                if (!dailyData[dateKey]) {
                    dailyData[dateKey] = [];
                }
                dailyData[dateKey].push(record);
            });

            const [year, month] = selectedMonth.split('-');
            
            let html = '<div style="background: white; padding: 2rem; border-radius: 1rem; border: 2px solid #e5e7eb;">';
            html += `<div style="text-align: center; margin-bottom: 2rem; border-bottom: 3px solid #16a34a; padding-bottom: 1rem;">`;
            html += `<h2 style="font-size: 2rem; color: #1f2937; margin-bottom: 0.5rem;">ÏòÅ ÎÜç Ïùº ÏßÄ</h2>`;
            html += `<p style="font-size: 1.2rem; color: #6b7280;">${year}ÎÖÑ ${parseInt(month)}Ïõî</p>`;
            html += `</div>`;

            // ÏòÅÎÜçÏùºÏßÄ ÌÖåÏù¥Î∏î
            html += '<table style="width: 100%; border-collapse: collapse; margin-bottom: 2rem;">';
            html += '<thead>';
            html += '<tr style="background: #f3f4f6; border: 2px solid #374151;">';
            html += '<th style="padding: 1rem; border: 1px solid #374151; width: 15%;">ÎÖÑÏõîÏùº</th>';
            html += '<th style="padding: 1rem; border: 1px solid #374151; width: 25%;">Ï£ºÏöî ÎÜçÏûëÏóÖ</th>';
            html += '<th style="padding: 1rem; border: 1px solid #374151; width: 30%;">ÎÜçÏûêÏû¨ ÏÇ¨Ïö©ÎÇ¥Ïó≠<br>(ÎπÑÎ£å, ÏïΩÏû¨)</th>';
            html += '<th style="padding: 1rem; border: 1px solid #374151; width: 30%;">ÏÉùÏÇ∞, Ï∂úÌïò ÎÇ¥Ïó≠</th>';
            html += '</tr>';
            html += '</thead>';
            html += '<tbody>';

            // ÎÇ†ÏßúÎ≥ÑÎ°ú Ï†ïÎ†¨
            const sortedDates = Object.keys(dailyData).sort();
            
            sortedDates.forEach(dateKey => {
                const dayRecords = dailyData[dateKey];
                const [y, m, d] = dateKey.split('-');
                
                // Ï£ºÏöî ÎÜçÏûëÏóÖ Ï†ïÎ¶¨
                const mainWorks = [];
                const materials = [];
                const productions = [];

                dayRecords.forEach(record => {
                    // ÏûëÏóÖ Ï∂îÍ∞Ä
                    if (record.task !== 'ÎØ∏Î∂ÑÎ•ò') {
                        const workText = `${record.crop} ${record.task}`;
                        if (!mainWorks.includes(workText)) {
                            mainWorks.push(workText);
                        }
                    }

                    // ÏûêÏû¨ ÏÇ¨Ïö© ÎÇ¥Ïó≠
                    if (record.material !== 'ÎØ∏ÏÇ¨Ïö©') {
                        const materialText = `${record.crop}: ${record.material}`;
                        if (!materials.includes(materialText)) {
                            materials.push(materialText);
                        }
                    }

                    // ÏÉùÏÇ∞/Ï∂úÌïò ÎÇ¥Ïó≠ (ÏàòÌôï Í¥ÄÎ†® ÏûëÏóÖ)
                    if (['ÏàòÌôï', 'ÏàòÌôïÌñà', 'Îî∞Í∏∞', 'ÎïÑ', 'Î≤†Í∏∞', 'Î≤¥', 'Ï∫êÍ∏∞', 'Ï∫§', 'Í±∞ÎëêÍ∏∞', 'Í±∞ÎíÄ', 'Ï∂úÌïò', 'Ìè¨Ïû•'].includes(record.task)) {
                        const productionText = `${record.crop} ${record.task}`;
                        if (!productions.includes(productionText)) {
                            productions.push(productionText);
                        }
                    }
                });

                html += '<tr>';
                html += `<td style="padding: 0.75rem; border: 1px solid #d1d5db; text-align: center; font-weight: 600;">${parseInt(m)}/${parseInt(d)}</td>`;
                html += `<td style="padding: 0.75rem; border: 1px solid #d1d5db; vertical-align: top;">${mainWorks.join('<br>') || '-'}</td>`;
                html += `<td style="padding: 0.75rem; border: 1px solid #d1d5db; vertical-align: top;">${materials.join('<br>') || '-'}</td>`;
                html += `<td style="padding: 0.75rem; border: 1px solid #d1d5db; vertical-align: top;">${productions.join('<br>') || '-'}</td>`;
                html += '</tr>';
            });

            // Îπà Ìñâ Ï∂îÍ∞Ä (ÏµúÏÜå 6Ìñâ Ïú†ÏßÄ)
            const emptyRows = Math.max(0, 6 - sortedDates.length);
            for (let i = 0; i < emptyRows; i++) {
                html += '<tr>';
                html += '<td style="padding: 1.5rem; border: 1px solid #d1d5db;">&nbsp;</td>';
                html += '<td style="padding: 1.5rem; border: 1px solid #d1d5db;">&nbsp;</td>';
                html += '<td style="padding: 1.5rem; border: 1px solid #d1d5db;">&nbsp;</td>';
                html += '<td style="padding: 1.5rem; border: 1px solid #d1d5db;">&nbsp;</td>';
                html += '</tr>';
            }

            html += '</tbody>';
            html += '</table>';

            // Ïù∏ÏáÑ Î≤ÑÌäº
            html += '<div style="text-align: center; margin-top: 2rem;">';
            html += '<button onclick="printReport()" class="btn btn-primary" style="width: auto; padding: 1rem 2rem;">üñ®Ô∏è ÏòÅÎÜçÏùºÏßÄ Ïù∏ÏáÑÌïòÍ∏∞</button>';
            html += '</div>';

            html += '</div>';

            document.getElementById('monthly-report-container').innerHTML = html;
        }

        function printReport() {
            window.print();
        }

        window.onload = function() {
            const savedRecords = localStorage.getItem('farmRecords');
            if (savedRecords) {
                records = JSON.parse(savedRecords);
            }
            
            initSpeechRecognition();
            updateRecordCount();
            renderInputView();
        };
    </script>
</body>
</html>