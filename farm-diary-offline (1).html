<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#16a34a">
    <meta name="description" content="ìŒì„±ìœ¼ë¡œ ê°„í¸í•˜ê²Œ ì˜ë†ì¼ì§€ë¥¼ ê¸°ë¡í•˜ê³  ê´€ë¦¬í•˜ì„¸ìš”">
    <title>ğŸŒ¾ ì˜ë†ì¼ì§€</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ì˜ë†ì¼ì§€">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #f0fdf4 0%, #dbeafe 100%);
            min-height: 100vh;
            padding: 1rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .header h1 {
            color: #15803d;
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }
        
        .header p {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        .nav {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .nav button {
            flex: 1;
            padding: 0.75rem;
            border: none;
            border-radius: 0.75rem;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .nav button.active {
            background: #16a34a;
            color: white;
        }
        
        .nav button:not(.active) {
            background: white;
            color: #374151;
        }
        
        .card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .card h3 {
            color: #1f2937;
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }
        
        .mode-switch {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .mode-switch button {
            flex: 1;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .mode-switch button.active {
            background: #16a34a;
            color: white;
        }
        
        .mode-switch button:not(.active) {
            background: #e5e7eb;
            color: #374151;
        }
        
        .mic-container {
            text-align: center;
            padding: 2rem 0;
        }
        
        .mic-button {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: none;
            font-size: 3rem;
            cursor: pointer;
            margin-bottom: 1rem;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            transition: all 0.2s;
        }
        
        .mic-button:hover {
            transform: scale(1.05);
        }
        
        .mic-button.listening {
            background: #dc2626;
            animation: pulse 2s infinite;
        }
        
        .mic-button:not(.listening) {
            background: #16a34a;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .mic-status {
            font-size: 1.2rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        
        .mic-hint {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        textarea {
            width: 100%;
            padding: 1rem;
            border: 2px solid #d1d5db;
            border-radius: 0.75rem;
            font-size: 1rem;
            resize: none;
            font-family: inherit;
            margin-bottom: 1rem;
        }
        
        textarea:focus {
            outline: none;
            border-color: #16a34a;
        }
        
        .btn {
            width: 100%;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.75rem;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: #16a34a;
            color: white;
        }
        
        .btn-primary:hover {
            background: #15803d;
        }
        
        .btn-primary:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        
        .info-box {
            background: #dbeafe;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
        }
        
        .info-box p {
            color: #1e40af;
            font-size: 0.9rem;
        }
        
        .result-box {
            background: #f3f4f6;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .result-label {
            color: #6b7280;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }
        
        .result-value {
            color: #1f2937;
            font-style: italic;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .stat-card {
            padding: 1rem;
            border-radius: 0.5rem;
            border: 2px solid;
        }
        
        .stat-card.green {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-color: #bbf7d0;
        }
        
        .stat-card.blue {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-color: #bfdbfe;
        }
        
        .stat-card.purple {
            background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
            border-color: #e9d5ff;
        }
        
        .record-item {
            border: 2px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.2s;
        }
        
        .record-item:hover {
            border-color: #16a34a;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .record-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 0.75rem;
        }
        
        .record-date {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        .delete-btn {
            background: none;
            border: none;
            color: #ef4444;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0.25rem;
        }
        
        .delete-btn:hover {
            color: #dc2626;
        }
        
        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }
        
        .tag {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .tag.green {
            background: #dcfce7;
            color: #15803d;
        }
        
        .tag.blue {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .tag.purple {
            background: #f3e8ff;
            color: #7c3aed;
        }
        
        .record-text {
            background: #f9fafb;
            padding: 0.75rem;
            border-radius: 0.5rem;
            color: #374151;
            font-style: italic;
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #9ca3af;
        }
        
        .empty-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .summary-card {
            background: linear-gradient(135deg, #16a34a 0%, #2563eb 100%);
            color: white;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .summary-item {
            background: rgba(255,255,255,0.2);
            padding: 1rem;
            border-radius: 0.5rem;
        }
        
        .summary-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 0.25rem;
        }
        
        .summary-value {
            font-size: 2rem;
            font-weight: bold;
        }
        
        .stat-bar-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.75rem;
        }
        
        .stat-label {
            min-width: 80px;
            font-weight: 600;
            color: #374151;
        }
        
        .stat-bar-bg {
            flex: 1;
            background: #e5e7eb;
            height: 32px;
            border-radius: 1rem;
            overflow: hidden;
            position: relative;
        }
        
        .stat-bar {
            height: 100%;
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 0.75rem;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
            transition: width 0.5s ease;
        }
        
        .stat-bar.green {
            background: linear-gradient(90deg, #4ade80 0%, #16a34a 100%);
        }
        
        .stat-bar.blue {
            background: linear-gradient(90deg, #60a5fa 0%, #2563eb 100%);
        }
        
        .stat-bar.purple {
            background: linear-gradient(90deg, #a78bfa 0%, #7c3aed 100%);
        }
        
        #install-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        #install-button {
            background: #16a34a;
            color: white;
            padding: 1rem 1.5rem;
            border: none;
            border-radius: 2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        #install-button:hover {
            background: #15803d;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.25rem;
            }
            
            .mic-button {
                width: 100px;
                height: 100px;
                font-size: 2.5rem;
            }
            
            .summary-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.5rem;
            }
            
            .summary-value {
                font-size: 1.5rem;
            }
            
            .stat-label {
                min-width: 60px;
                font-size: 0.9rem;
            }
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .container {
                max-width: 100%;
            }
            
            .header, .nav, #install-container {
                display: none !important;
            }
            
            .card {
                box-shadow: none;
                padding: 0;
            }
            
            button {
                display: none !important;
            }
            
            table {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div id="install-container" style="display: none;">
        <button id="install-button">ğŸ“± í™ˆ í™”ë©´ì— ì¶”ê°€</button>
    </div>

    <div class="container">
        <div class="header">
            <h1>ğŸŒ¾ ìŒì„± ê¸°ë°˜ ì˜ë†ì¼ì§€ ì‹œìŠ¤í…œ</h1>
            <p>ìŒì„±ì´ë‚˜ í…ìŠ¤íŠ¸ë¡œ ê°„í¸í•˜ê²Œ ì˜ë† í™œë™ì„ ê¸°ë¡í•˜ì„¸ìš”</p>
        </div>

        <div class="nav">
            <button id="btn-input" class="active" onclick="setView('input')">ğŸ“ ì¼ì§€ ì‘ì„±</button>
            <button id="btn-list" onclick="setView('list')">ğŸ“… ëª©ë¡ <span id="record-count">(0)</span></button>
            <button id="btn-stats" onclick="setView('stats')">ğŸ“Š í†µê³„</button>
            <button id="btn-report" onclick="setView('report')">ğŸ“‹ ì˜ë†ì¼ì§€</button>
        </div>

        <div id="content"></div>
    </div>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(reg => console.log('Service Worker ë“±ë¡ ì„±ê³µ'))
                    .catch(err => console.log('Service Worker ë“±ë¡ ì‹¤íŒ¨:', err));
            });
        }

        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('install-container').style.display = 'block';
        });

        document.getElementById('install-button').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                deferredPrompt = null;
                document.getElementById('install-container').style.display = 'none';
            }
        });

        let currentView = 'input';
        let inputMode = 'voice';
        let records = [];
        let currentRecord = null;
        let recognition = null;
        let isListening = false;

        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.lang = 'ko-KR';
                recognition.continuous = false;
                recognition.interimResults = false;

                recognition.onresult = (event) => {
                    const text = event.results[0][0].transcript;
                    document.getElementById('input-text').value = text;
                    analyzeText(text);
                };

                recognition.onerror = (event) => {
                    isListening = false;
                    updateMicButton();
                    if (event.error === 'not-allowed') {
                        alert('ë§ˆì´í¬ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.');
                    } else if (event.error === 'no-speech') {
                        alert('ìŒì„±ì´ ê°ì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                    }
                };

                recognition.onend = () => {
                    isListening = false;
                    updateMicButton();
                };

                recognition.onstart = () => {
                    isListening = true;
                    updateMicButton();
                };

                return true;
            }
            return false;
        }

        function analyzeText(text) {
            const crops = [
                'í¬ë„', 'ì‚¬ê³¼', 'ë°°', 'ë”¸ê¸°', 'ë³µìˆ­ì•„', 'ìë‘', 'ê°', 'ë°¤', 'ëŒ€ì¶”', 'ë§¤ì‹¤', 'ì‚´êµ¬', 'ì•µë‘', 
                'ê°ê·¤', 'ê·¤', 'í•œë¼ë´‰', 'ì²œí˜œí–¥', 'ë ˆë“œí–¥', 'ë¸”ë£¨ë² ë¦¬', 'í‚¤ìœ„', 'ë¬´í™”ê³¼', 'ì„ë¥˜', 'ì˜¤ë””',
                'í† ë§ˆí† ', 'ì˜¤ì´', 'ê³ ì¶”', 'ìƒì¶”', 'ë°°ì¶”', 'ë¬´', 'ë‹¹ê·¼', 'ì–‘íŒŒ', 'ë§ˆëŠ˜', 'íŒŒ', 'ìª½íŒŒ', 'ëŒ€íŒŒ',
                'ì‹œê¸ˆì¹˜', 'ê¹»ì', 'í˜¸ë°•', 'ê°€ì§€', 'í”¼ë§', 'íŒŒí”„ë¦¬ì¹´', 'ë¸Œë¡œì½œë¦¬', 'ì–‘ë°°ì¶”', 'ì½©', 'ì™„ë‘ì½©',
                'ê°•ë‚­ì½©', 'ì˜¥ìˆ˜ìˆ˜', 'ê°ì', 'ê³ êµ¬ë§ˆ', 'ìƒê°•', 'ìš°ì—‰', 'ì—°ê·¼', 'ì—´ë¬´', 'ê°“', 'ì‘¥ê°“',
                'ë²¼', 'ìŒ€', 'ë³´ë¦¬', 'ë°€', 'íŒ¥', 'ë…¹ë‘', 'ìˆ˜ìˆ˜', 'ì¡°', 'ê¸°ì¥',
                'ì°¸ê¹¨', 'ë“¤ê¹¨', 'ë•…ì½©', 'ê³ êµ¬ë§ˆìˆœ', 'ë”ë•', 'ë„ë¼ì§€', 'ì¸ì‚¼', 'ìˆ˜ì‚¼', 'ë²„ì„¯'
            ];

            const taskCategories = {
                'ê¸°ë³¸ì‘ì—…': ['ê²½ìš´', 'ë…¼ê°ˆì´', 'ë°­ê°ˆì´', 'ë¡œíƒ€ë¦¬', 'ì¨ë ˆì§ˆ', 'ì´ì•™', 'ëª¨ë‚´ê¸°', 'ì‹œë¹„', 'ë°‘ê±°ë¦„', 'ì›ƒê±°ë¦„', 'ìˆ˜í™•', 'ë”°ê¸°', 'ë² ê¸°', 'ìºê¸°'],
                'ë°©ì œì‘ì—…': ['ë°©ì œ', 'ì•½ì¹˜ê¸°', 'ì‚´í¬', 'ë¶„ë¬´', 'ë³‘í•´ì¶©ë°©ì œ', 'ì†Œë…', 'ë°©ì—­', 'ë†ì•½ì‚´í¬', 'ì˜ˆë°©'],
                'ìœ¡ë¬˜ì‘ì—…': ['íŒŒì¢…', 'ì”¨ë¿Œë¦¬ê¸°', 'ìœ¡ë¬˜', 'ëª¨ê¸°ë¥´ê¸°', 'ì†Œë…', 'ì¶œí•˜'],
                'ê´€ë¦¬ì‘ì—…': ['ë¬¼ì£¼ê¸°', 'ê´€ìˆ˜', 'ë¬¼ëŒ€ê¸°', 'ì œì´ˆ', 'í’€ë½‘ê¸°', 'ê¹€ë§¤ê¸°', 'ì „ì •', 'ê°€ì§€ì¹˜ê¸°', 'ìˆœì§€ë¥´ê¸°', 'ì ì‹¬', 'ìˆœë”°ê¸°']
            };

            const allTasks = [
                'íŒŒì¢…', 'ì”¨ë¿Œë¦¬ê¸°', 'ì”¨ë¿Œë¦¼', 'ë¿Œë ¸', 'ì‹¬ê¸°', 'ì‹¬ì—ˆ', 'ëª¨ë‚´ê¸°', 'ì´ì•™', 'ì •ì‹', 'ì˜®ê²¨ì‹¬ê¸°',
                'ìœ¡ë¬˜', 'ëª¨ê¸°ë¥´ê¸°', 'ì•„ì£¼ì‹¬ê¸°', 'ë³¸ë°­ì‹¬ê¸°',
                'ê´€ìˆ˜', 'ë¬¼ì£¼ê¸°', 'ë¬¼ì£¼ì—ˆ', 'ë¬¼ì¤¬', 'ë¬¼ëŒ€ê¸°', 'ë¬¼ëŒ”', 'ë¬¼ë¹¼ê¸°', 'ë¬¼ëº',
                'ì¤‘ê°„ë¬¼ë–¼ê¸°', 'ë¬¼ë–¼ê¸°', 'ë…¼ê°ˆì´', 'ë°­ê°ˆì´', 'ê²½ìš´', 'ë¡œíƒ€ë¦¬', 'ì¨ë ˆì§ˆ', 'ë‘ë‘‘ë§Œë“¤ê¸°',
                'ì‹œë¹„', 'ë¹„ë£Œì£¼ê¸°', 'ë°‘ê±°ë¦„', 'ì›ƒê±°ë¦„', 'ì¶”ë¹„', 'ê±°ë¦„ì£¼ê¸°', 'í‡´ë¹„', 'í‡´ë¹„ì£¼ê¸°',
                'ê¸°ë¹„', 'ì•¡ë¹„', 'ì—½ë©´ì‹œë¹„', 'ì˜ì–‘ì œ', 'ì¹¼ìŠ˜ì œ', 'ì² ë¶„ì œ',
                'ë°©ì œ', 'ì•½ì¹˜ê¸°', 'ì•½ì³¤', 'ì‚´í¬', 'ë¶„ë¬´', 'ë³‘í•´ì¶©ë°©ì œ', 'ì˜ˆë°©', 'ì†Œë…', 'ë°©ì—­',
                'ë†ì•½ì‚´í¬', 'ì‚´ì¶©ì œ', 'ì‚´ê· ì œ', 'ì œì´ˆì œ', 'ë†ì•½',
                'ì œì´ˆ', 'í’€ë½‘ê¸°', 'í’€ë½‘ì•˜', 'ê¹€ë§¤ê¸°', 'ê¹€ë§¸', 'ì œì´ˆì‘ì—…', 'ì¡ì´ˆì œê±°', 'ë§¤ê¸°',
                'ì „ì •', 'ê°€ì§€ì¹˜ê¸°', 'ìˆœì§€ë¥´ê¸°', 'ì ì‹¬', 'ìˆœë”°ê¸°', 'ìˆœì¹˜ê¸°', 'ì ê³¼', 'ì í™”',
                'ì†ì•„ë‚´ê¸°', 'ë§ê±°ë¦„', 'ìˆœ ì •ë¦¬', 'ê³ìˆœì œê±°', 'ê³ê°€ì§€ì œê±°', 'ì†ì§ˆ',
                'ìˆ˜í™•', 'ìˆ˜í™•í–ˆ', 'ë”°ê¸°', 'ë•„', 'ë² ê¸°', 'ë²´', 'ìºê¸°', 'ìº¤', 'ê±°ë‘ê¸°', 'ê±°ë’€',
                'ë”°ë‚´ê¸°', 'ë½‘ê¸°', 'ë½‘ì•˜', 'ìˆ˜í™•ì‘ì—…', 'ì¶œí•˜', 'í¬ì¥',
                'ì§€ì£¼ì„¸ìš°ê¸°', 'ìœ ì¸', 'ì§€ì£¼ì„¤ì¹˜', 'ë®ê°œ', 'ë©€ì¹­', 'ë¹„ë‹ì”Œìš°ê¸°', 'í•˜ìš°ìŠ¤ê´€ë¦¬',
                'í™˜ê¸°', 'ì˜¨ë„ê´€ë¦¬', 'ìŠµë„ì¡°ì ˆ', 'ë³´ì˜¨', 'ë‚œë°©', 'ëƒ‰ë°©', 'ì°¨ê´‘', 'ë¹„ê°€ë¦¼',
                'ìˆœì¹˜ê¸°', 'ìˆœ ì •ë¦¬', 'ê½ƒì†ê¸°', 'ì—´ë§¤ì†ê¸°', 'ë´‰ì§€ì”Œìš°ê¸°', 'ì ê³¼ì‘ì—…'
            ];

            const allMaterials = [
                'ë¹„ë£Œ', 'ë³µí•©ë¹„ë£Œ', 'ìš”ì†Œ', 'ìœ ê¸°ì§ˆë¹„ë£Œ', 'í‡´ë¹„', 'ê³„ë¶„', 'ëˆë¶„', 'ìš°ë¶„', 'ë…¹ë¹„',
                'ì§ˆì†Œë¹„ë£Œ', 'ì¸ì‚°ë¹„ë£Œ', 'ì¹¼ë¦¬ë¹„ë£Œ', 'NPK', 'ë¶•ì†Œ', 'ì¹¼ìŠ˜', 'ê³ í† ì„íšŒ', 'ì„íšŒ',
                'ë¯¸ëŸ‰ìš”ì†Œ', 'ê·œì‚°', 'í™©ì‚°ê°€ë¦¬', 'ì—¼í™”ê°€ë¦¬', 'ê³¼ë¦°ì‚°ì„íšŒ', 'ìš©ì„±ì¸ë¹„',
                'ì˜ì–‘ì œ', 'í™œë ¥ì œ', 'ë°œê·¼ì´‰ì§„ì œ', 'ê°œí™”ì´‰ì§„ì œ', 'ì°©ê³¼ì´‰ì§„ì œ', 'ìƒì¥ì¡°ì ˆì œ',
                'ì•„ë¯¸ë…¸ì‚°', 'ì¹¼ìŠ˜ì œ', 'ì² ë¶„ì œ', 'ì—½ë©´ì‹œë¹„ì œ', 'ì•¡ë¹„', 'ë¯¸ìƒë¬¼ì œ',
                'ë†ì•½', 'ì‚´ì¶©ì œ', 'ì‚´ê· ì œ', 'ì œì´ˆì œ', 'ì‚´ë¹„ì œ', 'ì‚´ì„ ì¶©ì œ',
                'ì „ì°©ì œ', 'ì¹œí™˜ê²½ë†ì•½', 'ìœ ê¸°ë†ìì¬', 'ë¯¸ìƒë¬¼ë†ì•½', 'í•´ì¶©ë°©ì œì œ',
                'ë¬¼', 'ê±°ë¦„', 'ë³ì§š', 'ì™•ê²¨', 'í†±ë°¥', 'ë¶€ì§í¬', 'ë©€ì¹­ë¹„ë‹', 'ì§€ì£¼ëŒ€',
                'ëˆ', 'ì² ì‚¬', 'ê·¸ë¬¼ë§', 'ì°¨ê´‘ë§', 'ë°©í’ë§', 'ë³´ì˜¨ë®ê°œ', 'í‘ìƒ‰ë¹„ë‹',
                'íˆ¬ëª…ë¹„ë‹', 'ì§š', 'ì€ë°•ë©€ì¹­', 'ìƒë¶„í•´ë©€ì¹­'
            ];

            let detectedCrop = '';
            let detectedTask = '';
            let detectedMaterial = '';
            let workCategory = '';

            crops.forEach(crop => {
                if (text.includes(crop)) detectedCrop = crop;
            });

            allTasks.forEach(task => {
                if (text.includes(task)) {
                    detectedTask = task;
                    for (const [category, tasks] of Object.entries(taskCategories)) {
                        if (tasks.includes(task)) {
                            workCategory = category;
                            break;
                        }
                    }
                    if (!workCategory) workCategory = 'ê´€ë¦¬ì‘ì—…';
                }
            });

            allMaterials.forEach(material => {
                if (text.includes(material)) detectedMaterial = material;
            });

            currentRecord = {
                id: Date.now(),
                date: new Date().toLocaleString('ko-KR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                }),
                rawText: text,
                crop: detectedCrop || 'ë¯¸ë¶„ë¥˜',
                task: detectedTask || 'ë¯¸ë¶„ë¥˜',
                material: detectedMaterial || 'ë¯¸ì‚¬ìš©',
                workCategory: workCategory || 'ê¸°íƒ€ì‘ì—…',
                timestamp: Date.now()
            };

            renderInputView();
        }

        function toggleListening() {
            if (!recognition) {
                alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return;
            }

            if (isListening) {
                recognition.stop();
            } else {
                document.getElementById('input-text').value = '';
                currentRecord = null;
                try {
                    recognition.start();
                } catch (error) {
                    alert('ìŒì„± ì¸ì‹ì„ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            }
        }

        function updateMicButton() {
            const btn = document.getElementById('mic-button');
            const status = document.getElementById('mic-status');
            if (btn && status) {
                if (isListening) {
                    btn.className = 'mic-button listening';
                    btn.innerHTML = 'ğŸ”´';
                    status.textContent = 'ğŸ”´ ë“£ê³  ìˆìŠµë‹ˆë‹¤...';
                } else {
                    btn.className = 'mic-button';
                    btn.innerHTML = 'ğŸ¤';
                    status.textContent = 'ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë§ì”€í•˜ì„¸ìš”';
                }
            }
        }

        function handleTextSubmit() {
            const text = document.getElementById('input-text').value.trim();
            if (text) {
                analyzeText(text);
            }
        }

        function saveRecord() {
            if (currentRecord) {
                records.unshift(currentRecord);
                localStorage.setItem('farmRecords', JSON.stringify(records));
                currentRecord = null;
                document.getElementById('input-text').value = '';
                alert('ì˜ë†ì¼ì§€ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“');
                renderInputView();
                updateRecordCount();
            }
        }

        function deleteRecord(id) {
            if (confirm('ì´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                records = records.filter(r => r.id !== id);
                localStorage.setItem('farmRecords', JSON.stringify(records));
                renderListView();
                updateRecordCount();
            }
        }

        function updateRecordCount() {
            document.getElementById('record-count').textContent = `(${records.length})`;
        }

        function getStats() {
            const cropCount = {};
            const taskCount = {};
            const materialCount = {};

            records.forEach(record => {
                cropCount[record.crop] = (cropCount[record.crop] || 0) + 1;
                taskCount[record.task] = (taskCount[record.task] || 0) + 1;
                if (record.material !== 'ë¯¸ì‚¬ìš©') {
                    materialCount[record.material] = (materialCount[record.material] || 0) + 1;
                }
            });

            return { cropCount, taskCount, materialCount };
        }

        function setView(view) {
            currentView = view;
            document.getElementById('btn-input').className = view === 'input' ? 'active' : '';
            document.getElementById('btn-list').className = view === 'list' ? 'active' : '';
            document.getElementById('btn-stats').className = view === 'stats' ? 'active' : '';
            document.getElementById('btn-report').className = view === 'report' ? 'active' : '';

            if (view === 'input') renderInputView();
            else if (view === 'list') renderListView();
            else if (view === 'stats') renderStatsView();
            else if (view === 'report') renderReportView();
        }

        function setInputMode(mode) {
            inputMode = mode;
            renderInputView();
        }

        function renderInputView() {
            const inputText = document.getElementById('input-text')?.value || '';
            
            let html = '<div class="card">';
            html += '<div class="mode-switch">';
            html += `<button class="${inputMode === 'voice' ? 'active' : ''}" onclick="setInputMode('voice')">ğŸ¤ ìŒì„± ì…ë ¥</button>`;
            html += `<button class="${inputMode === 'text' ? 'active' : ''}" onclick="setInputMode('text')">âŒ¨ï¸ í…ìŠ¤íŠ¸ ì…ë ¥</button>`;
            html += '</div>';

            if (inputMode === 'voice') {
                html += '<h3>ğŸ¤ ìŒì„±ìœ¼ë¡œ ë§ì”€í•´ì£¼ì„¸ìš”</h3>';
                html += '<div class="mic-container">';
                html += '<button id="mic-button" class="mic-button" onclick="toggleListening()">ğŸ¤</button>';
                html += '<p id="mic-status" class="mic-status">ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë§ì”€í•˜ì„¸ìš”</p>';
                html += '<p class="mic-hint">ì˜ˆ: "í¬ë„ì— ì˜ì–‘ì œ ì‚´í¬í–ˆì–´"</p>';
                html += '</div>';
                html += `<input type="text" id="input-text" value="${inputText}" style="display:none;">`;
            } else {
                html += '<h3>ğŸ“ ì˜ë† í™œë™ ì…ë ¥</h3>';
                html += `<textarea id="input-text" placeholder='ì˜ˆ: "í¬ë„ì— ì˜ì–‘ì œ ì‚´í¬í–ˆì–´", "í† ë§ˆí†  ìˆ˜í™•í–ˆì–´"' rows="4">${inputText}</textarea>`;
                html += '<button class="btn btn-primary" onclick="handleTextSubmit()">ğŸ“¨ ë¶„ì„í•˜ê¸°</button>';
            }

            html += '<div class="info-box">';
            html += '<p>ğŸ’¡ <strong>ì…ë ¥ ì˜ˆì‹œ:</strong> "í¬ë„ì— ì˜ì–‘ì œ ì‚´í¬í–ˆì–´", "ì‚¬ê³¼ ìˆ˜í™•í–ˆì–´"</p>';
            html += '</div></div>';

            if (inputText && inputMode === 'voice') {
                html += '<div class="card">';
                html += '<h3>ğŸ¤ ì¸ì‹ëœ ìŒì„±</h3>';
                html += `<p style="font-size: 1.1rem; color: #374151;">${inputText}</p>`;
                html += '</div>';
            }

            if (currentRecord) {
                html += '<div class="card">';
                html += '<h3><span style="font-size: 1.5rem;">âœ…</span> ìë™ ìƒì„±ëœ ì˜ë†ì¼ì§€</h3>';
                html += '<div class="result-box">';
                html += '<p class="result-label">ì…ë ¥í•œ ë‚´ìš©</p>';
                html += `<p class="result-value">"${currentRecord.rawText}"</p>`;
                html += '</div>';
                html += '<div class="grid">';
                html += '<div class="stat-card green">';
                html += '<p class="result-label">ğŸ“… ë‚ ì§œ/ì‹œê°„</p>';
                html += `<p style="font-weight: 600; color: #1f2937;">${currentRecord.date}</p>`;
                html += '</div>';
                html += '<div class="stat-card green">';
                html += '<p class="result-label">ğŸŒ± ì‘ë¬¼</p>';
                html += `<p style="font-weight: 600; color: #15803d; font-size: 1.2rem;">${currentRecord.crop}</p>`;
                html += '</div>';
                html += '<div class="stat-card blue">';
                html += '<p class="result-label">ğŸ”§ ì‘ì—…</p>';
                html += `<p style="font-weight: 600; color: #1e40af; font-size: 1.2rem;">${currentRecord.task}</p>`;
                html += '</div>';
                html += '<div class="stat-card purple">';
                html += '<p class="result-label">ğŸ’Š ìì¬</p>';
                html += `<p style="font-weight: 600; color: #7c3aed; font-size: 1.2rem;">${currentRecord.material}</p>`;
                html += '</div>';
                html += '</div>';
                html += '<button class="btn btn-primary" onclick="saveRecord()" style="font-size: 1.1rem;">ğŸ’¾ ì˜ë†ì¼ì§€ ì €ì¥í•˜ê¸°</button>';
                html += '</div>';
            }

            document.getElementById('content').innerHTML = html;
        }

        function renderListView() {
            let html = '<div class="card">';
            html += '<h3>ğŸ“… ì˜ë†ì¼ì§€ ëª©ë¡</h3>';

            if (records.length === 0) {
                html += '<div class="empty-state">';
                html += '<div class="empty-icon">ğŸ“­</div>';
                html += '<p>ì•„ì§ ê¸°ë¡ëœ ì˜ë†ì¼ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                html += '<p style="font-size: 0.9rem; margin-top: 0.5rem;">ì¼ì§€ ì‘ì„± íƒ­ì—ì„œ ì²« ê¸°ë¡ì„ ë‚¨ê²¨ë³´ì„¸ìš”!</p>';
                html += '</div>';
            } else {
                html += '<div style="margin-bottom: 2rem;">';
                html += '<button onclick="toggleReportView()" class="btn btn-primary" style="width: auto; margin-bottom: 1rem;">ğŸ“Š ì‘ì—… ìœ í˜•ë³„ ë³´ê³ ì„œ ë³´ê¸°</button>';
                html += '<div id="report-view" style="display: none;"></div>';
                html += '</div>';

                records.forEach(record => {
                    html += '<div class="record-item">';
                    html += '<div class="record-header">';
                    html += `<div><span class="record-date">${record.date}</span>`;
                    if (record.workCategory && record.workCategory !== 'ë¯¸ì‚¬ìš©') {
                        html += `<span class="tag" style="background: #fef3c7; color: #92400e; margin-left: 0.5rem;">${record.workCategory}</span>`;
                    }
                    html += `</div>`;
                    html += `<button class="delete-btn" onclick="deleteRecord(${record.id})">ğŸ—‘ï¸</button>`;
                    html += '</div>';
                    html += '<div class="tags">';
                    html += `<span class="tag green">ğŸŒ± ${record.crop}</span>`;
                    html += `<span class="tag blue">ğŸ”§ ${record.task}</span>`;
                    if (record.material !== 'ë¯¸ì‚¬ìš©') {
                        html += `<span class="tag purple">ğŸ’Š ${record.material}</span>`;
                    }
                    html += '</div>';
                    html += `<div class="record-text">"${record.rawText}"</div>`;
                    html += '</div>';
                });
            }

            html += '</div>';
            document.getElementById('content').innerHTML = html;
        }

        function toggleReportView() {
            const reportDiv = document.getElementById('report-view');
            if (reportDiv.style.display === 'none') {
                reportDiv.style.display = 'block';
                generateReport();
            } else {
                reportDiv.style.display = 'none';
            }
        }

        function generateReport() {
            const basicWork = records.filter(r => r.workCategory === 'ê¸°ë³¸ì‘ì—…');
            const pestControl = records.filter(r => r.workCategory === 'ë°©ì œì‘ì—…');
            const seedling = records.filter(r => r.workCategory === 'ìœ¡ë¬˜ì‘ì—…');
            const management = records.filter(r => r.workCategory === 'ê´€ë¦¬ì‘ì—…');
            const others = records.filter(r => !['ê¸°ë³¸ì‘ì—…', 'ë°©ì œì‘ì—…', 'ìœ¡ë¬˜ì‘ì—…', 'ê´€ë¦¬ì‘ì—…'].includes(r.workCategory));

            let html = '<div style="background: #f9fafb; padding: 1.5rem; border-radius: 1rem; border: 2px solid #e5e7eb;">';
            html += '<h3 style="color: #1f2937; margin-bottom: 1rem;">ğŸ“‹ ì‘ì—… ìœ í˜•ë³„ ì˜ë†ì¼ì§€ ë³´ê³ ì„œ</h3>';

            if (basicWork.length > 0) {
                html += '<div style="background: white; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">';
                html += '<h4 style="color: #16a34a; margin-bottom: 0.75rem;">ğŸšœ ê¸°ë³¸ ë†ì‘ì—… (ê²½ìš´/ì´ì•™/ì‹œë¹„/ìˆ˜í™•)</h4>';
                html += '<table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">';
                html += '<thead><tr style="background: #f3f4f6;"><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ë‚ ì§œ</th><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ì‘ë¬¼</th><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ì‘ì—…</th><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ìì¬</th></tr></thead>';
                html += '<tbody>';
                basicWork.forEach(r => {
                    html += `<tr><td style="padding: 0.5rem; border: 1px solid #d1d5db;">${r.date}</td><td style="padding: 0.5rem; border: 1px solid #d1d5db;">${r.crop}</td><td style="padding: 0.5rem; border: 1px solid #d1d5db;">${r.task}</td><td style="padding: 0.5rem; border: 1px solid #d1d5db;">${r.material}</td></tr>`;
                });
                html += '</tbody></table></div>';
            }

            if (pestControl.length > 0) {
                html += '<div style="background: white; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">';
                html += '<h4 style="color: #dc2626; margin-bottom: 0.75rem;">ğŸ’Š ë°©ì œì‘ì—… (ë†ì•½/ì˜ì–‘ì œ ì‚´í¬)</h4>';
                html += '<table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">';
                html += '<thead><tr style="background: #f3f4f6;"><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ë‚ ì§œ</th><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ì‘ë¬¼</th><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ì‘ì—…</th><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ìì¬</th></tr></thead>';
                html += '<tbody>';
                pestControl.forEach(r => {
                    html += `<tr><td style="padding: 0.5rem; border: 1px solid #d1d5db;">${r.date}</td><td style="padding: 0.5rem; border: 1px solid #d1d5db;">${r.crop}</td><td style="padding: 0.5rem; border: 1px solid #d1d5db;">${r.task}</td><td style="padding: 0.5rem; border: 1px solid #d1d5db;">${r.material}</td></tr>`;
                });
                html += '</tbody></table></div>';
            }

            if (seedling.length > 0) {
                html += '<div style="background: white; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">';
                html += '<h4 style="color: #2563eb; margin-bottom: 0.75rem;">ğŸŒ± ìœ¡ë¬˜ì‘ì—… (íŒŒì¢…/ì†Œë…/ì¶œí•˜)</h4>';
                html += '<table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">';
                html += '<thead><tr style="background: #f3f4f6;"><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ë‚ ì§œ</th><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ì‘ë¬¼</th><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ì‘ì—…</th><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ë¹„ê³ </th></tr></thead>';
                html += '<tbody>';
                seedling.forEach(r => {
                    html += `<tr><td style="padding: 0.5rem; border: 1px solid #d1d5db;">${r.date}</td><td style="padding: 0.5rem; border: 1px solid #d1d5db;">${r.crop}</td><td style="padding: 0.5rem; border: 1px solid #d1d5db;">${r.task}</td><td style="padding: 0.5rem; border: 1px solid #d1d5db;">${r.material}</td></tr>`;
                });
                html += '</tbody></table></div>';
            }

            if (management.length > 0) {
                html += '<div style="background: white; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">';
                html += '<h4 style="color: #7c3aed; margin-bottom: 0.75rem;">ğŸ”§ ì¼ìƒ ê´€ë¦¬ì‘ì—…</h4>';
                html += '<table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">';
                html += '<thead><tr style="background: #f3f4f6;"><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ë‚ ì§œ</th><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ì‘ë¬¼</th><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ì‘ì—…</th><th style="padding: 0.5rem; border: 1px solid #d1d5db;">ë‚´ìš©</th></tr></thead>';
                html += '<tbody>';
                management.forEach(r => {
                    html += `<tr><td style="padding: 0.5rem; border: 1px solid #d1d5db;">${r.date}</td><td style="padding: 0.5rem; border: 1px solid #d1d5db;">${r.crop}</td><td style="padding: 0.5rem; border: 1px solid #d1d5db;">${r.task}</td><td style="padding: 0.5rem; border: 1px solid #d1d5db; font-size: 0.85rem;">${r.rawText}</td></tr>`;
                });
                html += '</tbody></table></div>';
            }

            html += '<div style="background: linear-gradient(135deg, #16a34a 0%, #2563eb 100%); padding: 1rem; border-radius: 0.5rem; color: white;">';
            html += '<h4 style="margin-bottom: 0.5rem;">ğŸ“Š ì‘ì—… ìš”ì•½</h4>';
            html += `<p>ê¸°ë³¸ì‘ì—…: ${basicWork.length}ê±´ | ë°©ì œì‘ì—…: ${pestControl.length}ê±´ | ìœ¡ë¬˜ì‘ì—…: ${seedling.length}ê±´ | ê´€ë¦¬ì‘ì—…: ${management.length}ê±´ | ê¸°íƒ€: ${others.length}ê±´</p>`;
            html += '</div></div>';

            document.getElementById('report-view').innerHTML = html;
        }

        function renderStatsView() {
            const stats = getStats();
            let html = '<div>';

            if (records.length === 0) {
                html += '<div class="card"><div class="empty-state">';
                html += '<div class="empty-icon">ğŸ“Š</div>';
                html += '<p>í†µê³„ë¥¼ ë³´ë ¤ë©´ ë¨¼ì € ì˜ë†ì¼ì§€ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”!</p>';
                html += '</div></div>';
            } else {
                html += '<div class="summary-card">';
                html += '<h3>ğŸ“ˆ ì „ì²´ ìš”ì•½</h3>';
                html += '<div class="summary-grid">';
                html += '<div class="summary-item">';
                html += '<p class="summary-label">ì´ ê¸°ë¡</p>';
                html += `<p class="summary-value">${records.length}ê±´</p>`;
                html += '</div>';
                html += '<div class="summary-item">';
                html += '<p class="summary-label">ê´€ë¦¬ ì‘ë¬¼</p>';
                html += `<p class="summary-value">${Object.keys(stats.cropCount).length}ì¢…</p>`;
                html += '</div>';
                html += '<div class="summary-item">';
                html += '<p class="summary-label">ìˆ˜í–‰ ì‘ì—…</p>';
                html += `<p class="summary-value">${Object.keys(stats.taskCount).length}ì¢…</p>`;
                html += '</div>';
                html += '</div></div>';

                html += '<div class="card">';
                html += '<h3>ğŸŒ± ì‘ë¬¼ë³„ ê´€ë¦¬ í˜„í™©</h3>';
                Object.entries(stats.cropCount)
                    .sort((a, b) => b[1] - a[1])
                    .forEach(([crop, count]) => {
                        const percentage = Math.max((count / records.length) * 100, 15);
                        html += '<div class="stat-bar-container">';
                        html += `<div class="stat-label">${crop}</div>`;
                        html += '<div class="stat-bar-bg">';
                        html += `<div class="stat-bar green" style="width: ${percentage}%">${count}ê±´</div>`;
                        html += '</div></div>';
                    });
                html += '</div>';

                html += '<div class="card">';
                html += '<h3>ğŸ”§ ì‘ì—… ìœ í˜• ë¶„ì„</h3>';
                Object.entries(stats.taskCount)
                    .sort((a, b) => b[1] - a[1])
                    .forEach(([task, count]) => {
                        const percentage = Math.max((count / records.length) * 100, 15);
                        html += '<div class="stat-bar-container">';
                        html += `<div class="stat-label">${task}</div>`;
                        html += '<div class="stat-bar-bg">';
                        html += `<div class="stat-bar blue" style="width: ${percentage}%">${count}ê±´</div>`;
                        html += '</div></div>';
                    });
                html += '</div>';

                if (Object.keys(stats.materialCount).length > 0) {
                    html += '<div class="card">';
                    html += '<h3>ğŸ’Š ìì¬ ì‚¬ìš© í˜„í™©</h3>';
                    Object.entries(stats.materialCount)
                        .sort((a, b) => b[1] - a[1])
                        .forEach(([material, count]) => {
                            const percentage = Math.max((count / records.length) * 100, 15);
                            html += '<div class="stat-bar-container">';
                            html += `<div class="stat-label">${material}</div>`;
                            html += '<div class="stat-bar-bg">';
                            html += `<div class="stat-bar purple" style="width: ${percentage}%">${count}ê±´</div>`;
                            html += '</div></div>';
                        });
                    html += '</div>';
                }
            }

            html += '</div>';
            document.getElementById('content').innerHTML = html;
        }

        function renderReportView() {
            let html = '<div class="card">';
            html += '<h3>ğŸ“‹ ì˜ë†ì¼ì§€ ì¶œë ¥</h3>';

            if (records.length === 0) {
                html += '<div class="empty-state">';
                html += '<div class="empty-icon">ğŸ“‹</div>';
                html += '<p>ê¸°ë¡ì´ ì—†ì–´ì„œ ì˜ë†ì¼ì§€ë¥¼ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
                html += '</div></div>';
                document.getElementById('content').innerHTML = html;
                return;
            }

            // ì›”ë³„ë¡œ ê·¸ë£¹í™”
            const monthlyData = {};
            records.forEach(record => {
                const date = new Date(record.timestamp);
                const yearMonth = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                if (!monthlyData[yearMonth]) {
                    monthlyData[yearMonth] = [];
                }
                monthlyData[yearMonth].push(record);
            });

            // ì›” ì„ íƒ ë“œë¡­ë‹¤ìš´
            html += '<div style="margin-bottom: 1.5rem;">';
            html += '<label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">ì¡°íšŒí•  ì›” ì„ íƒ:</label>';
            html += '<select id="month-select" onchange="generateMonthlyReport()" style="width: 100%; padding: 0.75rem; border: 2px solid #d1d5db; border-radius: 0.5rem; font-size: 1rem;">';
            html += '<option value="">-- ì›” ì„ íƒ --</option>';
            Object.keys(monthlyData).sort().reverse().forEach(month => {
                const [year, m] = month.split('-');
                html += `<option value="${month}">${year}ë…„ ${parseInt(m)}ì›”</option>`;
            });
            html += '</select></div>';

            html += '<div id="monthly-report-container"></div>';
            html += '</div>';

            document.getElementById('content').innerHTML = html;
        }

        function generateMonthlyReport() {
            const selectedMonth = document.getElementById('month-select').value;
            if (!selectedMonth) {
                document.getElementById('monthly-report-container').innerHTML = '';
                return;
            }

            const monthRecords = records.filter(record => {
                const date = new Date(record.timestamp);
                const yearMonth = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                return yearMonth === selectedMonth;
            });

            // ë‚ ì§œë³„ë¡œ ê·¸ë£¹í™”
            const dailyData = {};
            monthRecords.forEach(record => {
                const date = new Date(record.timestamp);
                const dateKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
                if (!dailyData[dateKey]) {
                    dailyData[dateKey] = [];
                }
                dailyData[dateKey].push(record);
            });

            const [year, month] = selectedMonth.split('-');
            
            let html = '<div style="background: white; padding: 2rem; border-radius: 1rem; border: 2px solid #e5e7eb;">';
            html += `<div style="text-align: center; margin-bottom: 2rem; border-bottom: 3px solid #16a34a; padding-bottom: 1rem;">`;
            html += `<h2 style="font-size: 2rem; color: #1f2937; margin-bottom: 0.5rem;">ì˜ ë† ì¼ ì§€</h2>`;
            html += `<p style="font-size: 1.2rem; color: #6b7280;">${year}ë…„ ${parseInt(month)}ì›”</p>`;
            html += `</div>`;

            // ì˜ë†ì¼ì§€ í…Œì´ë¸”
            html += '<table style="width: 100%; border-collapse: collapse; margin-bottom: 2rem;">';
            html += '<thead>';
            html += '<tr style="background: #f3f4f6; border: 2px solid #374151;">';
            html += '<th style="padding: 1rem; border: 1px solid #374151; width: 15%;">ë…„ì›”ì¼</th>';
            html += '<th style="padding: 1rem; border: 1px solid #374151; width: 25%;">ì£¼ìš” ë†ì‘ì—…</th>';
            html += '<th style="padding: 1rem; border: 1px solid #374151; width: 30%;">ë†ìì¬ ì‚¬ìš©ë‚´ì—­<br>(ë¹„ë£Œ, ì•½ì¬)</th>';
            html += '<th style="padding: 1rem; border: 1px solid #374151; width: 30%;">ìƒì‚°, ì¶œí•˜ ë‚´ì—­</th>';
            html += '</tr>';
            html += '</thead>';
            html += '<tbody>';

            // ë‚ ì§œë³„ë¡œ ì •ë ¬
            const sortedDates = Object.keys(dailyData).sort();
            
            sortedDates.forEach(dateKey => {
                const dayRecords = dailyData[dateKey];
                const [y, m, d] = dateKey.split('-');
                
                // ì£¼ìš” ë†ì‘ì—… ì •ë¦¬
                const mainWorks = [];
                const materials = [];
                const productions = [];

                dayRecords.forEach(record => {
                    // ì‘ì—… ì¶”ê°€
                    if (record.task !== 'ë¯¸ë¶„ë¥˜') {
                        const workText = `${record.crop} ${record.task}`;
                        if (!mainWorks.includes(workText)) {
                            mainWorks.push(workText);
                        }
                    }

                    // ìì¬ ì‚¬ìš© ë‚´ì—­
                    if (record.material !== 'ë¯¸ì‚¬ìš©') {
                        const materialText = `${record.crop}: ${record.material}`;
                        if (!materials.includes(materialText)) {
                            materials.push(materialText);
                        }
                    }

                    // ìƒì‚°/ì¶œí•˜ ë‚´ì—­ (ìˆ˜í™• ê´€ë ¨ ì‘ì—…)
                    if (['ìˆ˜í™•', 'ìˆ˜í™•í–ˆ', 'ë”°ê¸°', 'ë•„', 'ë² ê¸°', 'ë²´', 'ìºê¸°', 'ìº¤', 'ê±°ë‘ê¸°', 'ê±°ë’€', 'ì¶œí•˜', 'í¬ì¥'].includes(record.task)) {
                        const productionText = `${record.crop} ${record.task}`;
                        if (!productions.includes(productionText)) {
                            productions.push(productionText);
                        }
                    }
                });

                html += '<tr>';
                html += `<td style="padding: 0.75rem; border: 1px solid #d1d5db; text-align: center; font-weight: 600;">${parseInt(m)}/${parseInt(d)}</td>`;
                html += `<td style="padding: 0.75rem; border: 1px solid #d1d5db; vertical-align: top;">${mainWorks.join('<br>') || '-'}</td>`;
                html += `<td style="padding: 0.75rem; border: 1px solid #d1d5db; vertical-align: top;">${materials.join('<br>') || '-'}</td>`;
                html += `<td style="padding: 0.75rem; border: 1px solid #d1d5db; vertical-align: top;">${productions.join('<br>') || '-'}</td>`;
                html += '</tr>';
            });

            // ë¹ˆ í–‰ ì¶”ê°€ (ìµœì†Œ 6í–‰ ìœ ì§€)
            const emptyRows = Math.max(0, 6 - sortedDates.length);
            for (let i = 0; i < emptyRows; i++) {
                html += '<tr>';
                html += '<td style="padding: 1.5rem; border: 1px solid #d1d5db;">&nbsp;</td>';
                html += '<td style="padding: 1.5rem; border: 1px solid #d1d5db;">&nbsp;</td>';
                html += '<td style="padding: 1.5rem; border: 1px solid #d1d5db;">&nbsp;</td>';
                html += '<td style="padding: 1.5rem; border: 1px solid #d1d5db;">&nbsp;</td>';
                html += '</tr>';
            }

            html += '</tbody>';
            html += '</table>';

            // ì¸ì‡„ ë²„íŠ¼
            html += '<div style="text-align: center; margin-top: 2rem;">';
            html += '<button onclick="printReport()" class="btn btn-primary" style="width: auto; padding: 1rem 2rem;">ğŸ–¨ï¸ ì˜ë†ì¼ì§€ ì¸ì‡„í•˜ê¸°</button>';
            html += '</div>';

            html += '</div>';

            document.getElementById('monthly-report-container').innerHTML = html;
        }

        function printReport() {
            window.print();
        }

        window.onload = function() {
            const savedRecords = localStorage.getItem('farmRecords');
            if (savedRecords) {
                records = JSON.parse(savedRecords);
            }
            
            initSpeechRecognition();
            updateRecordCount();
            renderInputView();
        };
    </script>
</body>
</html>