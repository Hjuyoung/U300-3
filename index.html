<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#16a34a">
    <title>üåæ ÏòÅÎÜçÏùºÏßÄ</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #f0fdf4 0%, #dbeafe 100%);
            min-height: 100vh;
            padding: 1rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .header h1 {
            color: #15803d;
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }
        
        .header p {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        .nav {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .nav button {
            flex: 1;
            padding: 0.75rem;
            border: none;
            border-radius: 0.75rem;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .nav button.active {
            background: #16a34a;
            color: white;
        }
        
        .nav button:not(.active) {
            background: white;
            color: #374151;
        }
        
        .card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .card h3 {
            color: #1f2937;
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }
        
        .mode-switch {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .mode-switch button {
            flex: 1;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .mode-switch button.active {
            background: #16a34a;
            color: white;
        }
        
        .mode-switch button:not(.active) {
            background: #e5e7eb;
            color: #374151;
        }
        
        .mic-container {
            text-align: center;
            padding: 2rem 0;
        }
        
        .mic-button {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: none;
            font-size: 3rem;
            cursor: pointer;
            margin-bottom: 1rem;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            transition: all 0.2s;
        }
        
        .mic-button:hover {
            transform: scale(1.05);
        }
        
        .mic-button.listening {
            background: #dc2626;
            animation: pulse 2s infinite;
        }
        
        .mic-button:not(.listening) {
            background: #16a34a;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .mic-status {
            font-size: 1.2rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        
        .mic-hint {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        textarea {
            width: 100%;
            padding: 1rem;
            border: 2px solid #d1d5db;
            border-radius: 0.75rem;
            font-size: 1rem;
            resize: none;
            font-family: inherit;
            margin-bottom: 1rem;
        }
        
        textarea:focus {
            outline: none;
            border-color: #16a34a;
        }
        
        .btn {
            width: 100%;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.75rem;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: #16a34a;
            color: white;
        }
        
        .btn-primary:hover {
            background: #15803d;
        }
        
        .btn-primary:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        
        .info-box {
            background: #dbeafe;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
        }
        
        .info-box p {
            color: #1e40af;
            font-size: 0.9rem;
        }
        
        .result-box {
            background: #f3f4f6;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .result-label {
            color: #6b7280;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }
        
        .result-value {
            color: #1f2937;
            font-style: italic;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .stat-card {
            padding: 1rem;
            border-radius: 0.5rem;
            border: 2px solid;
        }
        
        .stat-card.green {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-color: #bbf7d0;
        }
        
        .stat-card.blue {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-color: #bfdbfe;
        }
        
        .stat-card.purple {
            background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
            border-color: #e9d5ff;
        }
        
        .record-item {
            border: 2px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.2s;
        }
        
        .record-item:hover {
            border-color: #16a34a;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .record-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 0.75rem;
        }
        
        .record-date {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        .delete-btn {
            background: none;
            border: none;
            color: #ef4444;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0.25rem;
        }
        
        .delete-btn:hover {
            color: #dc2626;
        }
        
        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }
        
        .tag {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .tag.green {
            background: #dcfce7;
            color: #15803d;
        }
        
        .tag.blue {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .tag.purple {
            background: #f3e8ff;
            color: #7c3aed;
        }
        
        .record-text {
            background: #f9fafb;
            padding: 0.75rem;
            border-radius: 0.5rem;
            color: #374151;
            font-style: italic;
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #9ca3af;
        }
        
        .empty-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .summary-card {
            background: linear-gradient(135deg, #16a34a 0%, #2563eb 100%);
            color: white;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .summary-item {
            background: rgba(255,255,255,0.2);
            padding: 1rem;
            border-radius: 0.5rem;
        }
        
        .summary-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 0.25rem;
        }
        
        .summary-value {
            font-size: 2rem;
            font-weight: bold;
        }
        
        .stat-bar-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.75rem;
        }
        
        .stat-label {
            min-width: 80px;
            font-weight: 600;
            color: #374151;
        }
        
        .stat-bar-bg {
            flex: 1;
            background: #e5e7eb;
            height: 32px;
            border-radius: 1rem;
            overflow: hidden;
            position: relative;
        }
        
        .stat-bar {
            height: 100%;
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 0.75rem;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
            transition: width 0.5s ease;
        }
        
        .stat-bar.green {
            background: linear-gradient(90deg, #4ade80 0%, #16a34a 100%);
        }
        
        .stat-bar.blue {
            background: linear-gradient(90deg, #60a5fa 0%, #2563eb 100%);
        }
        
        .stat-bar.purple {
            background: linear-gradient(90deg, #a78bfa 0%, #7c3aed 100%);
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.25rem;
            }
            
            .mic-button {
                width: 100px;
                height: 100px;
                font-size: 2.5rem;
            }
            
            .summary-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.5rem;
            }
            
            .summary-value {
                font-size: 1.5rem;
            }
            
            .stat-label {
                min-width: 60px;
                font-size: 0.9rem;
            }
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .container {
                max-width: 100%;
            }
            
            .header, .nav {
                display: none !important;
            }
            
            .card {
                box-shadow: none;
                padding: 0;
            }
            
            button {
                display: none !important;
            }
            
            table {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåæ ÏùåÏÑ± Í∏∞Î∞ò ÏòÅÎÜçÏùºÏßÄ ÏãúÏä§ÌÖú</h1>
            <p>ÏùåÏÑ±Ïù¥ÎÇò ÌÖçÏä§Ìä∏Î°ú Í∞ÑÌé∏ÌïòÍ≤å ÏòÅÎÜç ÌôúÎèôÏùÑ Í∏∞Î°ùÌïòÏÑ∏Ïöî</p>
        </div>

        <div class="nav">
            <button id="btn-input" class="active">üìù ÏùºÏßÄ ÏûëÏÑ±</button>
            <button id="btn-list">üìÖ Î™©Î°ù <span id="record-count">(0)</span></button>
            <button id="btn-stats">üìä ÌÜµÍ≥Ñ</button>
            <button id="btn-report">üìã ÏòÅÎÜçÏùºÏßÄ</button>
        </div>

        <div id="content"></div>
    </div>

    <script>
        let currentView = 'input';
        let inputMode = 'voice';
        let records = [];
        let currentRecord = null;
        let recognition = null;
        let isListening = false;

        // ÎèôÏÇ¨ Ïñ¥ÎØ∏ Ï†úÍ±∞ Ìï®Ïàò
        function normalizeVerb(text) {
            text = text.replace(/ÌñàÏñ¥Ïöî?/g, '');
            text = text.replace(/ÌñàÍ≥†/g, '');
            text = text.replace(/ÌñàÎäîÎç∞/g, '');
            text = text.replace(/ÌñàÎã§/g, '');
            text = text.replace(/ÌñàÏùå/g, '');
            text = text.replace(/ÌñàÏäµÎãàÎã§/g, '');
            text = text.replace(/Ìï¥Ïöî?/g, '');
            text = text.replace(/ÌïòÍ≥†/g, '');
            text = text.replace(/Ìï©ÎãàÎã§/g, '');
            text = text.replace(/ÌïúÎã§/g, '');
            text = text.replace(/Ïù¥Ïïº/g, '');
            text = text.replace(/Ïù¥ÏóêÏöî/g, '');
            text = text.replace(/ÏòàÏöî/g, '');
            text = text.replace(/ÏûÖÎãàÎã§/g, '');
            text = text.replace(/Ïù¥Îã§/g, '');
            text = text.replace(/Ïñ¥ÏÑú/g, '');
            text = text.replace(/ÏïÑÏÑú/g, '');
            
            return text.trim();
        }

        // ÌïúÍ∏Ä Ïà´ÏûêÎ•º ÏïÑÎùºÎπÑÏïÑ Ïà´ÏûêÎ°ú Î≥ÄÌôò
        function convertKoreanNumbersToArabic(text) {
            // ÌïúÍ∏Ä Ïà´Ïûê Îß§Ìïë
            const koreanNumbers = {
                'ÏòÅ': 0, 'Í≥µ': 0,
                'Ïùº': 1, 'Ìïú': 1,
                'Ïù¥': 2, 'Îëê': 2,
                'ÏÇº': 3, 'ÏÑ∏': 3,
                'ÏÇ¨': 4, 'ÎÑ§': 4,
                'Ïò§': 5, 'Îã§ÏÑØ': 5,
                'Ïú°': 6, 'Ïó¨ÏÑØ': 6,
                'Ïπ†': 7, 'ÏùºÍ≥±': 7,
                'Ìåî': 8, 'Ïó¨Îçü': 8,
                'Íµ¨': 9, 'ÏïÑÌôâ': 9
            };
            
            const units = {
                'Ïã≠': 10,
                'Î∞±': 100,
                'Ï≤ú': 1000,
                'Îßå': 10000
            };

            // "Î∞±ÏÉÅÏûê" ‚Üí "100ÏÉÅÏûê", "Ïò§Ïã≠ÌÇ¨Î°ú" ‚Üí "50ÌÇ¨Î°ú" Îì± Î≥ÄÌôò
            let result = text;
            
            // Í∞ÑÎã®Ìïú Ìå®ÌÑ¥: Î∞±, Ï≤ú, Îßå Îì±ÏùÑ Ïà´ÏûêÎ°ú Î≥ÄÌôò
            result = result.replace(/Î∞±(\d*)(ÏÉÅÏûê|ÌÇ¨Î°ú|kg|Ìè¨ÎåÄ|Í∞ú|ÌÜ§)/gi, (match, num, unit) => {
                return `100${unit}`;
            });
            
            result = result.replace(/Ï≤ú(\d*)(ÏÉÅÏûê|ÌÇ¨Î°ú|kg|Ìè¨ÎåÄ|Í∞ú|ÌÜ§)/gi, (match, num, unit) => {
                return `1000${unit}`;
            });

            // "Ïò§Ïã≠" ‚Üí "50", "ÏÇºÏã≠" ‚Üí "30" Îì±
            result = result.replace(/(Ïùº|Ïù¥|ÏÇº|ÏÇ¨|Ïò§|Ïú°|Ïπ†|Ìåî|Íµ¨)?Ïã≠/g, (match, prefix) => {
                const num = prefix ? koreanNumbers[prefix] : 1;
                return (num * 10).toString();
            });

            // "Ïò§Î∞±" ‚Üí "500", "ÏÇºÎ∞±" ‚Üí "300" Îì±
            result = result.replace(/(Ïùº|Ïù¥|ÏÇº|ÏÇ¨|Ïò§|Ïú°|Ïπ†|Ìåî|Íµ¨)?Î∞±/g, (match, prefix) => {
                const num = prefix ? koreanNumbers[prefix] : 1;
                return (num * 100).toString();
            });

            // "Ïù¥Ï≤ú" ‚Üí "2000", "ÏÇºÏ≤ú" ‚Üí "3000" Îì±
            result = result.replace(/(Ïùº|Ïù¥|ÏÇº|ÏÇ¨|Ïò§|Ïú°|Ïπ†|Ìåî|Íµ¨)?Ï≤ú/g, (match, prefix) => {
                const num = prefix ? koreanNumbers[prefix] : 1;
                return (num * 1000).toString();
            });

            // Îã®Ïàú ÌïúÍ∏Ä Ïà´Ïûê ‚Üí ÏïÑÎùºÎπÑÏïÑ Ïà´Ïûê
            Object.keys(koreanNumbers).forEach(key => {
                const regex = new RegExp(key + '(?=ÏÉÅÏûê|ÌÇ¨Î°ú|kg|Ìè¨ÎåÄ|Í∞ú|ÌÜ§|Îì±Í∏â)', 'g');
                result = result.replace(regex, koreanNumbers[key].toString());
            });

            // "ÌäπÌíà" Îì±Í∏â Ï≤òÎ¶¨
            result = result.replace(/1Îì±Í∏â/g, '1Îì±Í∏â');
            result = result.replace(/ÏùºÎì±Í∏â/g, '1Îì±Í∏â');
            
            return result;
        }

        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.lang = 'ko-KR';
                recognition.continuous = false;
                recognition.interimResults = false;

                recognition.onresult = (event) => {
                    const text = event.results[0][0].transcript;
                    document.getElementById('input-text').value = text;
                    analyzeText(text);
                };

                recognition.onerror = (event) => {
                    isListening = false;
                    updateMicButton();
                    if (event.error === 'not-allowed') {
                        alert('ÎßàÏù¥ÌÅ¨ Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                    } else if (event.error === 'no-speech') {
                        alert('ÏùåÏÑ±Ïù¥ Í∞êÏßÄÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                    }
                };

                recognition.onend = () => {
                    isListening = false;
                    updateMicButton();
                };

                recognition.onstart = () => {
                    isListening = true;
                    updateMicButton();
                };

                return true;
            }
            return false;
        }

        function analyzeText(text) {
            const crops = [
                'Ìè¨ÎèÑ', 'ÏÇ¨Í≥º', 'Î∞∞', 'Îî∏Í∏∞', 'Î≥µÏà≠ÏïÑ', 'ÏûêÎëê', 'Í∞ê', 'Î∞§', 'ÎåÄÏ∂î', 'Îß§Ïã§', 'ÏÇ¥Íµ¨', 'ÏïµÎëê', 
                'Í∞êÍ∑§', 'Í∑§', 'ÌïúÎùºÎ¥â', 'Ï≤úÌòúÌñ•', 'Î†àÎìúÌñ•', 'Î∏îÎ£®Î≤†Î¶¨', 'ÌÇ§ÏúÑ', 'Î¨¥ÌôîÍ≥º', 'ÏÑùÎ•ò', 'Ïò§Îîî',
                'ÌÜ†ÎßàÌÜ†', 'Ïò§Ïù¥', 'Í≥†Ï∂î', 'ÏÉÅÏ∂î', 'Î∞∞Ï∂î', 'Î¨¥', 'ÎãπÍ∑º', 'ÏñëÌåå', 'ÎßàÎäò', 'Ìåå', 'Ï™ΩÌåå', 'ÎåÄÌåå',
                'ÏãúÍ∏àÏπò', 'ÍπªÏûé', 'Ìò∏Î∞ï', 'Í∞ÄÏßÄ', 'ÌîºÎßù', 'ÌååÌîÑÎ¶¨Ïπ¥', 'Î∏åÎ°úÏΩúÎ¶¨', 'ÏñëÎ∞∞Ï∂î', 'ÏΩ©', 'ÏôÑÎëêÏΩ©',
                'Í∞ïÎÇ≠ÏΩ©', 'Ïò•ÏàòÏàò', 'Í∞êÏûê', 'Í≥†Íµ¨Îßà', 'ÏÉùÍ∞ï', 'Ïö∞Ïóâ', 'Ïó∞Í∑º', 'Ïó¥Î¨¥', 'Í∞ì', 'Ïë•Í∞ì',
                'Î≤º', 'ÏåÄ', 'Î≥¥Î¶¨', 'Î∞Ä', 'Ìå•', 'ÎÖπÎëê', 'ÏàòÏàò', 'Ï°∞', 'Í∏∞Ïû•',
                'Ï∞∏Íπ®', 'Îì§Íπ®', 'ÎïÖÏΩ©', 'Í≥†Íµ¨ÎßàÏàú', 'ÎçîÎçï', 'ÎèÑÎùºÏßÄ', 'Ïù∏ÏÇº', 'ÏàòÏÇº', 'Î≤ÑÏÑØ'
            ];

            const harvestTasks = ['ÏàòÌôï', 'Îî∞Í∏∞', 'Îî∞', 'ÎïÑ', 'Î≤†Í∏∞', 'Î≤†', 'Î≤†Ïñ¥', 'Ï∫êÍ∏∞', 'Ï∫ê', 'Ï∫§', 'Í±∞ÎëêÍ∏∞', 'Í±∞Îëê', 'Í±∞ÎíÄ'];
            const shipmentTasks = ['Ï∂úÌïò', 'ÌåêÎß§', 'Ìåî', 'ÌåîÏïò', 'ÎÇ©Ìíà', 'Î∞∞ÏÜ°', 'Ïö¥ÏÜ°', 'ÏßÅÍ±∞Îûò', 'ÎèÑÎß§'];

            let detectedCrop = '';
            let detectedTask = '';
            let cleanTask = '';
            let quantity = '';
            let unit = '';
            let quality = '';
            let storage = '';
            let buyer = '';
            let workCategory = '';

            crops.forEach(crop => {
                if (text.includes(crop)) detectedCrop = crop;
            });

            let isHarvest = false;
            harvestTasks.forEach(task => {
                if (text.includes(task)) {
                    detectedTask = text.match(new RegExp(`\\S*${task}\\S*`))[0];
                    cleanTask = 'ÏàòÌôï';
                    workCategory = 'ÏÉùÏÇ∞ÏûëÏóÖ';
                    isHarvest = true;
                }
            });

            shipmentTasks.forEach(task => {
                if (text.includes(task)) {
                    detectedTask = text.match(new RegExp(`\\S*${task}\\S*`))[0];
                    cleanTask = normalizeVerb(detectedTask);
                    if (!cleanTask) cleanTask = 'Ï∂úÌïò';
                    workCategory = 'Ï∂úÌïòÏûëÏóÖ';
                }
            });

            const quantityMatch = text.match(/(\d+(?:\.\d+)?)\s*(kg|KG|Kg|ÌÇ¨Î°ú|ÌÇ§Î°ú|ÌÜ§|t|T|ÏÉÅÏûê|Î∞ïÏä§|Ìè¨ÎåÄ|ÏûêÎ£®|Í∞ú|ÏÜ°Ïù¥|Îã§Î∞ú|Îßê)/i);
            if (quantityMatch) {
                quantity = quantityMatch[1];
                unit = quantityMatch[2];
            }

            const qualityKeywords = ['ÌäπÌíà', 'ÏÉÅÌíà', 'Ï§ëÌíà', 'ÌïòÌíà', 'AÍ∏â', 'BÍ∏â', 'CÍ∏â', '1Îì±Í∏â', '2Îì±Í∏â', '3Îì±Í∏â', 'ÌäπÎì±', 'Ìäπ'];
            qualityKeywords.forEach(qual => {
                if (text.includes(qual)) quality = qual;
            });

            const storageKeywords = ['Ï†ÄÏò®Ï∞ΩÍ≥†', 'ÎÉâÏû•Í≥†', 'Ï∞ΩÍ≥†', 'Ï†ÄÏû•', 'Î≥¥Í¥Ä', 'ÎÉâÎèô', 'Ïã§Ïò®'];
            storageKeywords.forEach(stor => {
                if (text.includes(stor)) storage = stor;
            });

            const buyerKeywords = ['ÎÜçÌòë', 'ÎèÑÎß§ÏãúÏû•', 'ÎßàÌä∏', 'ÏßÅÍ±∞Îûò', 'ÏÜåÎπÑÏûê', 'ÎÇ©Ìíà', 'ÎåÄÌòïÎßàÌä∏', 'Î°úÏª¨Ìë∏Îìú', 'Ïò®ÎùºÏù∏', 'ÏßÅÌåêÏû•'];
            buyerKeywords.forEach(buy => {
                if (text.includes(buy)) buyer = buy;
            });

            currentRecord = {
                id: Date.now(),
                date: new Date().toLocaleString('ko-KR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                }),
                rawText: text,
                crop: detectedCrop || 'ÎØ∏Î∂ÑÎ•ò',
                task: cleanTask || normalizeVerb(detectedTask) || 'ÎØ∏Î∂ÑÎ•ò',
                originalTask: detectedTask,
                material: 'ÎØ∏ÏÇ¨Ïö©',
                workCategory: workCategory || 'Í∏∞ÌÉÄÏûëÏóÖ',
                quantity: quantity,
                unit: unit,
                quality: quality,
                storage: storage,
                buyer: buyer,
                timestamp: Date.now()
            };

            renderInputView();
        }

        function toggleListening() {
            if (!recognition) {
                alert('Ïù¥ Î∏åÎùºÏö∞Ï†ÄÎäî ÏùåÏÑ± Ïù∏ÏãùÏùÑ ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.');
                return;
            }

            if (isListening) {
                recognition.stop();
            } else {
                document.getElementById('input-text').value = '';
                currentRecord = null;
                try {
                    recognition.start();
                } catch (error) {
                    alert('ÏùåÏÑ± Ïù∏ÏãùÏùÑ ÏãúÏûëÌï† Ïàò ÏóÜÏäµÎãàÎã§.');
                }
            }
        }

        function updateMicButton() {
            const btn = document.getElementById('mic-button');
            const status = document.getElementById('mic-status');
            if (btn && status) {
                if (isListening) {
                    btn.className = 'mic-button listening';
                    btn.innerHTML = 'üî¥';
                    status.textContent = 'üî¥ Îì£Í≥† ÏûàÏäµÎãàÎã§...';
                } else {
                    btn.className = 'mic-button';
                    btn.innerHTML = 'üé§';
                    status.textContent = 'ÎßàÏù¥ÌÅ¨ Î≤ÑÌäºÏùÑ ÎàåÎü¨ ÎßêÏîÄÌïòÏÑ∏Ïöî';
                }
            }
        }

        function handleTextSubmit() {
            const text = document.getElementById('input-text').value.trim();
            if (text) {
                analyzeText(text);
            }
        }

        function saveRecord() {
            if (currentRecord) {
                records.unshift(currentRecord);
                currentRecord = null;
                document.getElementById('input-text').value = '';
                alert('ÏòÅÎÜçÏùºÏßÄÍ∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§! üìù');
                renderInputView();
                updateRecordCount();
            }
        }

        function deleteRecord(id) {
            if (confirm('Ïù¥ Í∏∞Î°ùÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                records = records.filter(r => r.id !== id);
                renderListView();
                updateRecordCount();
            }
        }

        function updateRecordCount() {
            document.getElementById('record-count').textContent = `(${records.length})`;
        }

        function setView(view) {
            currentView = view;
            document.getElementById('btn-input').className = view === 'input' ? 'active' : '';
            document.getElementById('btn-list').className = view === 'list' ? 'active' : '';
            document.getElementById('btn-stats').className = view === 'stats' ? 'active' : '';
            document.getElementById('btn-report').className = view === 'report' ? 'active' : '';

            if (view === 'input') renderInputView();
            else if (view === 'list') renderListView();
            else if (view === 'stats') renderStatsView();
            else if (view === 'report') renderReportView();
        }

        function setInputMode(mode) {
            inputMode = mode;
            renderInputView();
        }

        function renderInputView() {
            const inputText = document.getElementById('input-text')?.value || '';
            
            let html = '<div class="card">';
            html += '<div class="mode-switch">';
            html += `<button class="${inputMode === 'voice' ? 'active' : ''}" onclick="setInputMode('voice')">üé§ ÏùåÏÑ± ÏûÖÎ†•</button>`;
            html += `<button class="${inputMode === 'text' ? 'active' : ''}" onclick="setInputMode('text')">‚å®Ô∏è ÌÖçÏä§Ìä∏ ÏûÖÎ†•</button>`;
            html += '</div>';

            if (inputMode === 'voice') {
                html += '<h3>üé§ ÏùåÏÑ±ÏúºÎ°ú ÎßêÏîÄÌï¥Ï£ºÏÑ∏Ïöî</h3>';
                html += '<div class="mic-container">';
                html += '<button id="mic-button" class="mic-button" onclick="toggleListening()">üé§</button>';
                html += '<p id="mic-status" class="mic-status">ÎßàÏù¥ÌÅ¨ Î≤ÑÌäºÏùÑ ÎàåÎü¨ ÎßêÏîÄÌïòÏÑ∏Ïöî</p>';
                html += '<p class="mic-hint">Ïòà: "ÏÇ¨Í≥º 100ÏÉÅÏûê ÏàòÌôïÌñàÏñ¥ ÌäπÌíà"</p>';
                html += '</div>';
                html += `<input type="text" id="input-text" value="${inputText}" style="display:none;">`;
            } else {
                html += '<h3>üìù ÏòÅÎÜç ÌôúÎèô ÏûÖÎ†•</h3>';
                html += `<textarea id="input-text" placeholder='Ïòà: "ÏÇ¨Í≥º 100ÏÉÅÏûê ÏàòÌôïÌñàÏñ¥", "Ìè¨ÎèÑ 50ÌÇ¨Î°ú ÎÜçÌòëÏóê Ï∂úÌïòÌñàÏñ¥"' rows="4">${inputText}</textarea>`;
                html += '<button class="btn btn-primary" onclick="handleTextSubmit()">üî® Î∂ÑÏÑùÌïòÍ∏∞</button>';
            }

            html += '<div class="info-box">';
            html += '<p>üí° <strong>ÏûÖÎ†• ÏòàÏãú:</strong> "ÏÇ¨Í≥º 100ÏÉÅÏûê ÏàòÌôïÌñàÏñ¥ ÌäπÌíà", "ÌÜ†ÎßàÌÜ† ÏàòÌôïÌï¥ÏÑú Ï†ÄÏò®Ï∞ΩÍ≥†Ïóê Î≥¥Í¥ÄÌñàÏñ¥"</p>';
            html += '</div></div>';

            if (inputText && inputMode === 'voice') {
                html += '<div class="card">';
                html += '<h3>üé§ Ïù∏ÏãùÎêú ÏùåÏÑ±</h3>';
                html += `<p style="font-size: 1.1rem; color: #374151;">${inputText}</p>`;
                html += '</div>';
            }

            if (currentRecord) {
                html += '<div class="card">';
                html += '<h3><span style="font-size: 1.5rem;">‚úÖ</span> ÏûêÎèô ÏÉùÏÑ±Îêú ÏòÅÎÜçÏùºÏßÄ</h3>';
                html += '<div class="result-box">';
                html += '<p class="result-label">ÏûÖÎ†•Ìïú ÎÇ¥Ïö©</p>';
                html += `<p class="result-value">"${currentRecord.rawText}"</p>`;
                html += '</div>';
                html += '<div class="grid">';
                html += '<div class="stat-card green">';
                html += '<p class="result-label">üìÖ ÎÇ†Ïßú/ÏãúÍ∞Ñ</p>';
                html += `<p style="font-weight: 600; color: #1f2937;">${currentRecord.date}</p>`;
                html += '</div>';
                html += '<div class="stat-card green">';
                html += '<p class="result-label">üå± ÏûëÎ¨º</p>';
                html += `<p style="font-weight: 600; color: #15803d; font-size: 1.2rem;">${currentRecord.crop}</p>`;
                html += '</div>';
                html += '<div class="stat-card blue">';
                html += '<p class="result-label">üîß ÏûëÏóÖ</p>';
                html += `<p style="font-weight: 600; color: #1e40af; font-size: 1.2rem;">${currentRecord.task}</p>`;
                html += '</div>';
                
                if (currentRecord.quantity && currentRecord.unit) {
                    html += '<div class="stat-card purple">';
                    html += '<p class="result-label">üì¶ ÏàòÎüâ</p>';
                    html += `<p style="font-weight: 600; color: #7c3aed; font-size: 1.2rem;">${currentRecord.quantity}${currentRecord.unit}</p>`;
                    html += '</div>';
                }
                
                if (currentRecord.quality) {
                    html += '<div class="stat-card purple">';
                    html += '<p class="result-label">‚≠ê ÌíàÏßà</p>';
                    html += `<p style="font-weight: 600; color: #7c3aed; font-size: 1.2rem;">${currentRecord.quality}</p>`;
                    html += '</div>';
                }
                
                if (currentRecord.buyer) {
                    html += '<div class="stat-card blue">';
                    html += '<p class="result-label">üè™ Ï∂úÌïòÏ≤ò</p>';
                    html += `<p style="font-weight: 600; color: #1e40af; font-size: 1.2rem;">${currentRecord.buyer}</p>`;
                    html += '</div>';
                }
                
                if (currentRecord.storage) {
                    html += '<div class="stat-card green">';
                    html += '<p class="result-label">üì¶ Ï†ÄÏû•</p>';
                    html += `<p style="font-weight: 600; color: #15803d; font-size: 1.2rem;">${currentRecord.storage}</p>`;
                    html += '</div>';
                }
                
                html += '</div>';
                html += '<button class="btn btn-primary" onclick="saveRecord()" style="font-size: 1.1rem;">üíæ ÏòÅÎÜçÏùºÏßÄ Ï†ÄÏû•ÌïòÍ∏∞</button>';
                html += '</div>';
            }

            document.getElementById('content').innerHTML = html;
        }

        function renderListView() {
            let html = '<div class="card">';
            html += '<h3>üìÖ ÏòÅÎÜçÏùºÏßÄ Î™©Î°ù</h3>';

            if (records.length === 0) {
                html += '<div class="empty-state">';
                html += '<div class="empty-icon">üî≠</div>';
                html += '<p>ÏïÑÏßÅ Í∏∞Î°ùÎêú ÏòÅÎÜçÏùºÏßÄÍ∞Ä ÏóÜÏäµÎãàÎã§.</p>';
                html += '<p style="font-size: 0.9rem; margin-top: 0.5rem;">ÏùºÏßÄ ÏûëÏÑ± ÌÉ≠ÏóêÏÑú Ï≤´ Í∏∞Î°ùÏùÑ ÎÇ®Í≤®Î≥¥ÏÑ∏Ïöî!</p>';
                html += '</div>';
            } else {
                records.forEach(record => {
                    html += '<div class="record-item">';
                    html += '<div class="record-header">';
                    html += `<div><span class="record-date">${record.date}</span>`;
                    if (record.workCategory && record.workCategory !== 'ÎØ∏ÏÇ¨Ïö©') {
                        html += `<span class="tag" style="background: #fef3c7; color: #92400e; margin-left: 0.5rem;">${record.workCategory}</span>`;
                    }
                    html += `</div>`;
                    html += `<button class="delete-btn" onclick="deleteRecord(${record.id})">üóëÔ∏è</button>`;
                    html += '</div>';
                    html += '<div class="tags">';
                    html += `<span class="tag green">üå± ${record.crop}</span>`;
                    html += `<span class="tag blue">üîß ${record.task}</span>`;
                    if (record.quantity && record.unit) {
                        html += `<span class="tag purple">üì¶ ${record.quantity}${record.unit}</span>`;
                    }
                    if (record.quality) {
                        html += `<span class="tag purple">‚≠ê ${record.quality}</span>`;
                    }
                    if (record.buyer) {
                        html += `<span class="tag blue">üè™ ${record.buyer}</span>`;
                    }
                    html += '</div>';
                    html += `<div class="record-text">"${record.rawText}"</div>`;
                    html += '</div>';
                });
            }

            html += '</div>';
            document.getElementById('content').innerHTML = html;
        }

        function renderStatsView() {
            let html = '<div>';

            if (records.length === 0) {
                html += '<div class="card"><div class="empty-state">';
                html += '<div class="empty-icon">üìä</div>';
                html += '<p>ÌÜµÍ≥ÑÎ•º Î≥¥Î†§Î©¥ Î®ºÏ†Ä ÏòÅÎÜçÏùºÏßÄÎ•º ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî!</p>';
                html += '</div></div>';
            } else {
                const cropCount = {};
                const taskCount = {};
                
                records.forEach(record => {
                    cropCount[record.crop] = (cropCount[record.crop] || 0) + 1;
                    taskCount[record.task] = (taskCount[record.task] || 0) + 1;
                });

                html += '<div class="summary-card">';
                html += '<h3>üìà Ï†ÑÏ≤¥ ÏöîÏïΩ</h3>';
                html += '<div class="summary-grid">';
                html += '<div class="summary-item">';
                html += '<p class="summary-label">Ï¥ù Í∏∞Î°ù</p>';
                html += `<p class="summary-value">${records.length}Í±¥</p>`;
                html += '</div>';
                html += '<div class="summary-item">';
                html += '<p class="summary-label">Í¥ÄÎ¶¨ ÏûëÎ¨º</p>';
                html += `<p class="summary-value">${Object.keys(cropCount).length}Ï¢Ö</p>`;
                html += '</div>';
                html += '<div class="summary-item">';
                html += '<p class="summary-label">ÏàòÌñâ ÏûëÏóÖ</p>';
                html += `<p class="summary-value">${Object.keys(taskCount).length}Ï¢Ö</p>`;
                html += '</div>';
                html += '</div></div>';

                html += '<div class="card">';
                html += '<h3>üå± ÏûëÎ¨ºÎ≥Ñ Í¥ÄÎ¶¨ ÌòÑÌô©</h3>';
                Object.entries(cropCount)
                    .sort((a, b) => b[1] - a[1])
                    .forEach(([crop, count]) => {
                        const percentage = Math.max((count / records.length) * 100, 15);
                        html += '<div class="stat-bar-container">';
                        html += `<div class="stat-label">${crop}</div>`;
                        html += '<div class="stat-bar-bg">';
                        html += `<div class="stat-bar green" style="width: ${percentage}%">${count}Í±¥</div>`;
                        html += '</div></div>';
                    });
                html += '</div>';

                html += '<div class="card">';
                html += '<h3>üîß ÏûëÏóÖ Ïú†Ìòï Î∂ÑÏÑù</h3>';
                Object.entries(taskCount)
                    .sort((a, b) => b[1] - a[1])
                    .forEach(([task, count]) => {
                        const percentage = Math.max((count / records.length) * 100, 15);
                        html += '<div class="stat-bar-container">';
                        html += `<div class="stat-label">${task}</div>`;
                        html += '<div class="stat-bar-bg">';
                        html += `<div class="stat-bar blue" style="width: ${percentage}%">${count}Í±¥</div>`;
                        html += '</div></div>';
                    });
                html += '</div>';
            }

            html += '</div>';
            document.getElementById('content').innerHTML = html;
        }

        function renderReportView() {
            let html = '<div class="card">';
            html += '<h3>üìã ÏòÅÎÜçÏùºÏßÄ Ï∂úÎ†•</h3>';

            if (records.length === 0) {
                html += '<div class="empty-state">';
                html += '<div class="empty-icon">üìã</div>';
                html += '<p>Í∏∞Î°ùÏù¥ ÏóÜÏñ¥ÏÑú ÏòÅÎÜçÏùºÏßÄÎ•º ÏÉùÏÑ±Ìï† Ïàò ÏóÜÏäµÎãàÎã§.</p>';
                html += '</div></div>';
                document.getElementById('content').innerHTML = html;
                return;
            }

            const monthlyData = {};
            records.forEach(record => {
                const date = new Date(record.timestamp);
                const yearMonth = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                if (!monthlyData[yearMonth]) {
                    monthlyData[yearMonth] = [];
                }
                monthlyData[yearMonth].push(record);
            });

            html += '<div style="margin-bottom: 1.5rem;">';
            html += '<label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">Ï°∞ÌöåÌï† Ïõî ÏÑ†ÌÉù:</label>';
            html += '<select id="month-select" onchange="generateMonthlyReport()" style="width: 100%; padding: 0.75rem; border: 2px solid #d1d5db; border-radius: 0.5rem; font-size: 1rem;">';
            html += '<option value="">-- Ïõî ÏÑ†ÌÉù --</option>';
            Object.keys(monthlyData).sort().reverse().forEach(month => {
                const [year, m] = month.split('-');
                html += `<option value="${month}">${year}ÎÖÑ ${parseInt(m)}Ïõî</option>`;
            });
            html += '</select></div>';

            html += '<div id="monthly-report-container"></div>';
            html += '</div>';

            document.getElementById('content').innerHTML = html;
        }

        function generateMonthlyReport() {
            const selectedMonth = document.getElementById('month-select').value;
            if (!selectedMonth) {
                document.getElementById('monthly-report-container').innerHTML = '';
                return;
            }

            const monthRecords = records.filter(record => {
                const date = new Date(record.timestamp);
                const yearMonth = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                return yearMonth === selectedMonth;
            });

            const dailyData = {};
            monthRecords.forEach(record => {
                const date = new Date(record.timestamp);
                const dateKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
                if (!dailyData[dateKey]) {
                    dailyData[dateKey] = [];
                }
                dailyData[dateKey].push(record);
            });

            const [year, month] = selectedMonth.split('-');
            
            let html = '<div style="background: white; padding: 2rem; border-radius: 1rem; border: 2px solid #e5e7eb;">';
            html += `<div style="text-align: center; margin-bottom: 2rem; border-bottom: 3px solid #16a34a; padding-bottom: 1rem;">`;
            html += `<h2 style="font-size: 2rem; color: #1f2937; margin-bottom: 0.5rem;">ÏòÅÎÜçÏùºÏßÄ</h2>`;
            html += `<p style="font-size: 1.2rem; color: #6b7280;">${year}ÎÖÑ ${parseInt(month)}Ïõî</p>`;
            html += `</div>`;

            html += '<table style="width: 100%; border-collapse: collapse; margin-bottom: 2rem;">';
            html += '<thead>';
            html += '<tr style="background: #f3f4f6; border: 2px solid #374151;">';
            html += '<th style="padding: 1rem; border: 1px solid #374151; width: 15%;">ÎÖÑÏõîÏùº</th>';
            html += '<th style="padding: 1rem; border: 1px solid #374151; width: 25%;">Ï£ºÏöî ÎÜçÏûëÏóÖ</th>';
            html += '<th style="padding: 1rem; border: 1px solid #374151; width: 30%;">ÎÜçÏûêÏû¨ ÏÇ¨Ïö©ÎÇ¥Ïó≠<br>(ÎπÑÎ£å, ÏïΩÏû¨)</th>';
            html += '<th style="padding: 1rem; border: 1px solid #374151; width: 30%;">ÏÉùÏÇ∞, Ï∂úÌïò ÎÇ¥Ïó≠</th>';
            html += '</tr>';
            html += '</thead>';
            html += '<tbody>';

            const sortedDates = Object.keys(dailyData).sort();
            
            sortedDates.forEach(dateKey => {
                const dayRecords = dailyData[dateKey];
                const [y, m, d] = dateKey.split('-');
                
                const mainWorks = [];
                const materials = [];
                const productions = [];

                dayRecords.forEach(record => {
                    if (record.task !== 'ÎØ∏Î∂ÑÎ•ò') {
                        const workText = `${record.crop} ${record.task}`;
                        if (!mainWorks.includes(workText)) {
                            mainWorks.push(workText);
                        }
                    }

                    if (record.workCategory === 'ÏÉùÏÇ∞ÏûëÏóÖ' || record.workCategory === 'Ï∂úÌïòÏûëÏóÖ') {
                        let productionText = `${record.crop} ${record.task}`;
                        
                        const details = [];
                        if (record.quantity && record.unit) {
                            details.push(`${record.quantity}${record.unit}`);
                        }
                        if (record.quality) {
                            details.push(record.quality);
                        }
                        if (record.storage) {
                            details.push(record.storage);
                        }
                        if (record.buyer) {
                            details.push(record.buyer);
                        }
                        
                        if (details.length > 0) {
                            productionText += ` (${details.join(', ')})`;
                        }
                        
                        if (!productions.includes(productionText)) {
                            productions.push(productionText);
                        }
                    }
                });

                html += '<tr>';
                html += `<td style="padding: 0.75rem; border: 1px solid #d1d5db; text-align: center; font-weight: 600;">${parseInt(m)}/${parseInt(d)}</td>`;
                html += `<td style="padding: 0.75rem; border: 1px solid #d1d5db; vertical-align: top;">${mainWorks.join('<br>') || '-'}</td>`;
                html += `<td style="padding: 0.75rem; border: 1px solid #d1d5db; vertical-align: top;">${materials.join('<br>') || '-'}</td>`;
                html += `<td style="padding: 0.75rem; border: 1px solid #d1d5db; vertical-align: top;">${productions.join('<br>') || '-'}</td>`;
                html += '</tr>';
            });

            const emptyRows = Math.max(0, 6 - sortedDates.length);
            for (let i = 0; i < emptyRows; i++) {
                html += '<tr>';
                html += '<td style="padding: 1.5rem; border: 1px solid #d1d5db;">&nbsp;</td>';
                html += '<td style="padding: 1.5rem; border: 1px solid #d1d5db;">&nbsp;</td>';
                html += '<td style="padding: 1.5rem; border: 1px solid #d1d5db;">&nbsp;</td>';
                html += '<td style="padding: 1.5rem; border: 1px solid #d1d5db;">&nbsp;</td>';
                html += '</tr>';
            }

            html += '</tbody>';
            html += '</table>';

            html += '<div style="text-align: center; margin-top: 2rem;">';
            html += '<button onclick="printReport()" class="btn btn-primary" style="width: auto; padding: 1rem 2rem;">üñ®Ô∏è ÏòÅÎÜçÏùºÏßÄ Ïù∏ÏáÑÌïòÍ∏∞</button>';
            html += '</div>';

            html += '</div>';

            document.getElementById('monthly-report-container').innerHTML = html;
        }

        function printReport() {
            window.print();
        }

        // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
        document.addEventListener('DOMContentLoaded', function() {
            initSpeechRecognition();
            updateRecordCount();
            renderInputView();
            
            // ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Î≤ÑÌäº Ïù¥Î≤§Ìä∏
            document.getElementById('btn-input').addEventListener('click', () => setView('input'));
            document.getElementById('btn-list').addEventListener('click', () => setView('list'));
            document.getElementById('btn-stats').addEventListener('click', () => setView('stats'));
            document.getElementById('btn-report').addEventListener('click', () => setView('report'));
        });
    </script>
</body>
</html>
