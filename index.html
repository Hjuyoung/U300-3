<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#16a34a">
    <title>ğŸŒ¾ ì˜ë†ì¼ì§€</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #f0fdf4 0%, #dbeafe 100%);
            min-height: 100vh;
            padding: 1rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .header h1 {
            color: #15803d;
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }
        
        .header p {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        .nav {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .nav button {
            flex: 1;
            padding: 0.75rem;
            border: none;
            border-radius: 0.75rem;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .nav button.active {
            background: #16a34a;
            color: white;
        }
        
        .nav button:not(.active) {
            background: white;
            color: #374151;
        }
        
        .card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .card h3 {
            color: #1f2937;
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }
        
        .mode-switch {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .mode-switch button {
            flex: 1;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .mode-switch button.active {
            background: #16a34a;
            color: white;
        }
        
        .mode-switch button:not(.active) {
            background: #e5e7eb;
            color: #374151;
        }
        
        .mic-container {
            text-align: center;
            padding: 2rem 0;
        }
        
        .mic-button {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: none;
            font-size: 3rem;
            cursor: pointer;
            margin-bottom: 1rem;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            transition: all 0.2s;
        }
        
        .mic-button:hover {
            transform: scale(1.05);
        }
        
        .mic-button.listening {
            background: #dc2626;
            animation: pulse 2s infinite;
        }
        
        .mic-button:not(.listening) {
            background: #16a34a;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .mic-status {
            font-size: 1.2rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        
        .mic-hint {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        textarea {
            width: 100%;
            padding: 1rem;
            border: 2px solid #d1d5db;
            border-radius: 0.75rem;
            font-size: 1rem;
            resize: none;
            font-family: inherit;
            margin-bottom: 1rem;
        }
        
        textarea:focus {
            outline: none;
            border-color: #16a34a;
        }
        
        .btn {
            width: 100%;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.75rem;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: #16a34a;
            color: white;
        }
        
        .btn-primary:hover {
            background: #15803d;
        }
        
        .btn-primary:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        
        .info-box {
            background: #dbeafe;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
        }
        
        .info-box p {
            color: #1e40af;
            font-size: 0.9rem;
        }
        
        .result-box {
            background: #f3f4f6;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .result-label {
            color: #6b7280;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }
        
        .result-value {
            color: #1f2937;
            font-style: italic;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .stat-card {
            padding: 1rem;
            border-radius: 0.5rem;
            border: 2px solid;
        }
        
        .stat-card.green {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-color: #bbf7d0;
        }
        
        .stat-card.blue {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-color: #bfdbfe;
        }
        
        .stat-card.purple {
            background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
            border-color: #e9d5ff;
        }
        
        .record-item {
            border: 2px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.2s;
        }
        
        .record-item:hover {
            border-color: #16a34a;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .record-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 0.75rem;
        }
        
        .record-date {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        .delete-btn {
            background: none;
            border: none;
            color: #ef4444;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0.25rem;
        }
        
        .delete-btn:hover {
            color: #dc2626;
        }
        
        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }
        
        .tag {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .tag.green {
            background: #dcfce7;
            color: #15803d;
        }
        
        .tag.blue {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .tag.purple {
            background: #f3e8ff;
            color: #7c3aed;
        }
        
        .record-text {
            background: #f9fafb;
            padding: 0.75rem;
            border-radius: 0.5rem;
            color: #374151;
            font-style: italic;
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #9ca3af;
        }
        
        .empty-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .summary-card {
            background: linear-gradient(135deg, #16a34a 0%, #2563eb 100%);
            color: white;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .summary-item {
            background: rgba(255,255,255,0.2);
            padding: 1rem;
            border-radius: 0.5rem;
        }
        
        .summary-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 0.25rem;
        }
        
        .summary-value {
            font-size: 2rem;
            font-weight: bold;
        }
        
        .stat-bar-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.75rem;
        }
        
        .stat-label {
            min-width: 80px;
            font-weight: 600;
            color: #374151;
        }
        
        .stat-bar-bg {
            flex: 1;
            background: #e5e7eb;
            height: 32px;
            border-radius: 1rem;
            overflow: hidden;
            position: relative;
        }
        
        .stat-bar {
            height: 100%;
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 0.75rem;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
            transition: width 0.5s ease;
        }
        
        .stat-bar.green {
            background: linear-gradient(90deg, #4ade80 0%, #16a34a 100%);
        }
        
        .stat-bar.blue {
            background: linear-gradient(90deg, #60a5fa 0%, #2563eb 100%);
        }
        
        .stat-bar.purple {
            background: linear-gradient(90deg, #a78bfa 0%, #7c3aed 100%);
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.25rem;
            }
            
            .mic-button {
                width: 100px;
                height: 100px;
                font-size: 2.5rem;
            }
            
            .summary-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.5rem;
            }
            
            .summary-value {
                font-size: 1.5rem;
            }
            
            .stat-label {
                min-width: 60px;
                font-size: 0.9rem;
            }
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .container {
                max-width: 100%;
            }
            
            .header, .nav {
                display: none !important;
            }
            
            .card {
                box-shadow: none;
                padding: 0;
            }
            
            button {
                display: none !important;
            }
            
            table {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒ¾ ìŒì„± ê¸°ë°˜ ì˜ë†ì¼ì§€ ì‹œìŠ¤í…œ</h1>
            <p>ìŒì„±ì´ë‚˜ í…ìŠ¤íŠ¸ë¡œ ê°„í¸í•˜ê²Œ ì˜ë† í™œë™ì„ ê¸°ë¡í•˜ì„¸ìš”</p>
        </div>

        <div class="nav">
            <button id="btn-input" class="active">ğŸ“ ì¼ì§€ ì‘ì„±</button>
            <button id="btn-list">ğŸ“… ëª©ë¡ <span id="record-count">(0)</span></button>
            <button id="btn-stats">ğŸ“Š í†µê³„</button>
            <button id="btn-report">ğŸ“‹ ì˜ë†ì¼ì§€</button>
        </div>

        <div id="content"></div>
    </div>

    <script>
        let currentView = 'input';
        let inputMode = 'voice';
        let records = [];
        let currentRecord = null;
        let recognition = null;
        let isListening = false;

        // ë™ì‚¬ ì–´ë¯¸ ì œê±° í•¨ìˆ˜
        function normalizeVerb(text) {
            text = text.replace(/í–ˆì–´ìš”?/g, '');
            text = text.replace(/í–ˆê³ /g, '');
            text = text.replace(/í–ˆëŠ”ë°/g, '');
            text = text.replace(/í–ˆë‹¤/g, '');
            text = text.replace(/í–ˆìŒ/g, '');
            text = text.replace(/í–ˆìŠµë‹ˆë‹¤/g, '');
            text = text.replace(/í•´ìš”?/g, '');
            text = text.replace(/í•˜ê³ /g, '');
            text = text.replace(/í•©ë‹ˆë‹¤/g, '');
            text = text.replace(/í•œë‹¤/g, '');
            text = text.replace(/ì´ì•¼/g, '');
            text = text.replace(/ì´ì—ìš”/g, '');
            text = text.replace(/ì˜ˆìš”/g, '');
            text = text.replace(/ì…ë‹ˆë‹¤/g, '');
            text = text.replace(/ì´ë‹¤/g, '');
            text = text.replace(/ì–´ì„œ/g, '');
            text = text.replace(/ì•„ì„œ/g, '');
            
            return text.trim();
        }

        // í•œê¸€ ìˆ«ìë¥¼ ì•„ë¼ë¹„ì•„ ìˆ«ìë¡œ ë³€í™˜
        function convertKoreanNumbersToArabic(text) {
            // í•œê¸€ ìˆ«ì ë§¤í•‘
            const koreanNumbers = {
                'ì˜': 0, 'ê³µ': 0,
                'ì¼': 1, 'í•œ': 1,
                'ì´': 2, 'ë‘': 2,
                'ì‚¼': 3, 'ì„¸': 3,
                'ì‚¬': 4, 'ë„¤': 4,
                'ì˜¤': 5, 'ë‹¤ì„¯': 5,
                'ìœ¡': 6, 'ì—¬ì„¯': 6,
                'ì¹ ': 7, 'ì¼ê³±': 7,
                'íŒ”': 8, 'ì—¬ëŸ': 8,
                'êµ¬': 9, 'ì•„í™‰': 9
            };
            
            const units = {
                'ì‹­': 10,
                'ë°±': 100,
                'ì²œ': 1000,
                'ë§Œ': 10000
            };

            // "ë°±ìƒì" â†’ "100ìƒì", "ì˜¤ì‹­í‚¬ë¡œ" â†’ "50í‚¬ë¡œ" ë“± ë³€í™˜
            let result = text;
            
            // ê°„ë‹¨í•œ íŒ¨í„´: ë°±, ì²œ, ë§Œ ë“±ì„ ìˆ«ìë¡œ ë³€í™˜
            result = result.replace(/ë°±(\d*)(ìƒì|í‚¬ë¡œ|kg|í¬ëŒ€|ê°œ|í†¤)/gi, (match, num, unit) => {
                return `100${unit}`;
            });
            
            result = result.replace(/ì²œ(\d*)(ìƒì|í‚¬ë¡œ|kg|í¬ëŒ€|ê°œ|í†¤)/gi, (match, num, unit) => {
                return `1000${unit}`;
            });

            // "ì˜¤ì‹­" â†’ "50", "ì‚¼ì‹­" â†’ "30" ë“±
            result = result.replace(/(ì¼|ì´|ì‚¼|ì‚¬|ì˜¤|ìœ¡|ì¹ |íŒ”|êµ¬)?ì‹­/g, (match, prefix) => {
                const num = prefix ? koreanNumbers[prefix] : 1;
                return (num * 10).toString();
            });

            // "ì˜¤ë°±" â†’ "500", "ì‚¼ë°±" â†’ "300" ë“±
            result = result.replace(/(ì¼|ì´|ì‚¼|ì‚¬|ì˜¤|ìœ¡|ì¹ |íŒ”|êµ¬)?ë°±/g, (match, prefix) => {
                const num = prefix ? koreanNumbers[prefix] : 1;
                return (num * 100).toString();
            });

            // "ì´ì²œ" â†’ "2000", "ì‚¼ì²œ" â†’ "3000" ë“±
            result = result.replace(/(ì¼|ì´|ì‚¼|ì‚¬|ì˜¤|ìœ¡|ì¹ |íŒ”|êµ¬)?ì²œ/g, (match, prefix) => {
                const num = prefix ? koreanNumbers[prefix] : 1;
                return (num * 1000).toString();
            });

            // ë‹¨ìˆœ í•œê¸€ ìˆ«ì â†’ ì•„ë¼ë¹„ì•„ ìˆ«ì
            Object.keys(koreanNumbers).forEach(key => {
                const regex = new RegExp(key + '(?=ìƒì|í‚¬ë¡œ|kg|í¬ëŒ€|ê°œ|í†¤|ë“±ê¸‰)', 'g');
                result = result.replace(regex, koreanNumbers[key].toString());
            });

            // "íŠ¹í’ˆ" ë“±ê¸‰ ì²˜ë¦¬
            result = result.replace(/1ë“±ê¸‰/g, '1ë“±ê¸‰');
            result = result.replace(/ì¼ë“±ê¸‰/g, '1ë“±ê¸‰');
            
            return result;
        }

        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.lang = 'ko-KR';
                recognition.continuous = false;
                recognition.interimResults = false;

                recognition.onresult = (event) => {
                    const text = event.results[0][0].transcript;
                    document.getElementById('input-text').value = text;
                    analyzeText(text);
                };

                recognition.onerror = (event) => {
                    isListening = false;
                    updateMicButton();
                    if (event.error === 'not-allowed') {
                        alert('ë§ˆì´í¬ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.');
                    } else if (event.error === 'no-speech') {
                        alert('ìŒì„±ì´ ê°ì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                    }
                };

                recognition.onend = () => {
                    isListening = false;
                    updateMicButton();
                };

                recognition.onstart = () => {
                    isListening = true;
                    updateMicButton();
                };

                return true;
            }
            return false;
        }

        function analyzeText(text) {
            const crops = [
                'í¬ë„', 'ì‚¬ê³¼', 'ë°°', 'ë”¸ê¸°', 'ë³µìˆ­ì•„', 'ìë‘', 'ê°', 'ë°¤', 'ëŒ€ì¶”', 'ë§¤ì‹¤', 'ì‚´êµ¬', 'ì•µë‘', 
                'ê°ê·¤', 'ê·¤', 'í•œë¼ë´‰', 'ì²œí˜œí–¥', 'ë ˆë“œí–¥', 'ë¸”ë£¨ë² ë¦¬', 'í‚¤ìœ„', 'ë¬´í™”ê³¼', 'ì„ë¥˜', 'ì˜¤ë””',
                'í† ë§ˆí† ', 'ì˜¤ì´', 'ê³ ì¶”', 'ìƒì¶”', 'ë°°ì¶”', 'ë¬´', 'ë‹¹ê·¼', 'ì–‘íŒŒ', 'ë§ˆëŠ˜', 'íŒŒ', 'ìª½íŒŒ', 'ëŒ€íŒŒ',
                'ì‹œê¸ˆì¹˜', 'ê¹»ì', 'í˜¸ë°•', 'ê°€ì§€', 'í”¼ë§', 'íŒŒí”„ë¦¬ì¹´', 'ë¸Œë¡œì½œë¦¬', 'ì–‘ë°°ì¶”', 'ì½©', 'ì™„ë‘ì½©',
                'ê°•ë‚­ì½©', 'ì˜¥ìˆ˜ìˆ˜', 'ê°ì', 'ê³ êµ¬ë§ˆ', 'ìƒê°•', 'ìš°ì—‰', 'ì—°ê·¼', 'ì—´ë¬´', 'ê°“', 'ì‘¥ê°“',
                'ë²¼', 'ìŒ€', 'ë³´ë¦¬', 'ë°€', 'íŒ¥', 'ë…¹ë‘', 'ìˆ˜ìˆ˜', 'ì¡°', 'ê¸°ì¥',
                'ì°¸ê¹¨', 'ë“¤ê¹¨', 'ë•…ì½©', 'ê³ êµ¬ë§ˆìˆœ', 'ë”ë•', 'ë„ë¼ì§€', 'ì¸ì‚¼', 'ìˆ˜ì‚¼', 'ë²„ì„¯'
            ];

            const harvestTasks = ['ìˆ˜í™•', 'ë”°ê¸°', 'ë”°', 'ë•„', 'ë² ê¸°', 'ë² ', 'ë² ì–´', 'ìºê¸°', 'ìº', 'ìº¤', 'ê±°ë‘ê¸°', 'ê±°ë‘', 'ê±°ë’€'];
            const shipmentTasks = ['ì¶œí•˜', 'íŒë§¤', 'íŒ”', 'íŒ”ì•˜', 'ë‚©í’ˆ', 'ë°°ì†¡', 'ìš´ì†¡', 'ì§ê±°ë˜', 'ë„ë§¤'];

            let detectedCrop = '';
            let detectedTask = '';
            let cleanTask = '';
            let quantity = '';
            let unit = '';
            let quality = '';
            let storage = '';
            let buyer = '';
            let workCategory = '';

            crops.forEach(crop => {
                if (text.includes(crop)) detectedCrop = crop;
            });

            let isHarvest = false;
            harvestTasks.forEach(task => {
                if (text.includes(task)) {
                    detectedTask = text.match(new RegExp(`\\S*${task}\\S*`))[0];
                    cleanTask = 'ìˆ˜í™•';
                    workCategory = 'ìƒì‚°ì‘ì—…';
                    isHarvest = true;
                }
            });

            shipmentTasks.forEach(task => {
                if (text.includes(task)) {
                    detectedTask = text.match(new RegExp(`\\S*${task}\\S*`))[0];
                    cleanTask = normalizeVerb(detectedTask);
                    if (!cleanTask) cleanTask = 'ì¶œí•˜';
                    workCategory = 'ì¶œí•˜ì‘ì—…';
                }
            });

            const quantityMatch = text.match(/(\d+(?:\.\d+)?)\s*(kg|KG|Kg|í‚¬ë¡œ|í‚¤ë¡œ|í†¤|t|T|ìƒì|ë°•ìŠ¤|í¬ëŒ€|ìë£¨|ê°œ|ì†¡ì´|ë‹¤ë°œ|ë§)/i);
            if (quantityMatch) {
                quantity = quantityMatch[1];
                unit = quantityMatch[2];
            }

            const qualityKeywords = ['íŠ¹í’ˆ', 'ìƒí’ˆ', 'ì¤‘í’ˆ', 'í•˜í’ˆ', 'Aê¸‰', 'Bê¸‰', 'Cê¸‰', '1ë“±ê¸‰', '2ë“±ê¸‰', '3ë“±ê¸‰', 'íŠ¹ë“±', 'íŠ¹'];
            qualityKeywords.forEach(qual => {
                if (text.includes(qual)) quality = qual;
            });

            const storageKeywords = ['ì €ì˜¨ì°½ê³ ', 'ëƒ‰ì¥ê³ ', 'ì°½ê³ ', 'ì €ì¥', 'ë³´ê´€', 'ëƒ‰ë™', 'ì‹¤ì˜¨'];
            storageKeywords.forEach(stor => {
                if (text.includes(stor)) storage = stor;
            });

            const buyerKeywords = ['ë†í˜‘', 'ë„ë§¤ì‹œì¥', 'ë§ˆíŠ¸', 'ì§ê±°ë˜', 'ì†Œë¹„ì', 'ë‚©í’ˆ', 'ëŒ€í˜•ë§ˆíŠ¸', 'ë¡œì»¬í‘¸ë“œ', 'ì˜¨ë¼ì¸', 'ì§íŒì¥'];
            buyerKeywords.forEach(buy => {
                if (text.includes(buy)) buyer = buy;
            });

            currentRecord = {
                id: Date.now(),
                date: new Date().toLocaleString('ko-KR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                }),
                rawText: text,
                crop: detectedCrop || 'ë¯¸ë¶„ë¥˜',
                task: cleanTask || normalizeVerb(detectedTask) || 'ë¯¸ë¶„ë¥˜',
                originalTask: detectedTask,
                material: 'ë¯¸ì‚¬ìš©',
                workCategory: workCategory || 'ê¸°íƒ€ì‘ì—…',
                quantity: quantity,
                unit: unit,
                quality: quality,
                storage: storage,
                buyer: buyer,
                timestamp: Date.now()
            };

            renderInputView();
        }

        function toggleListening() {
            if (!recognition) {
                alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return;
            }

            if (isListening) {
                recognition.stop();
            } else {
                document.getElementById('input-text').value = '';
                currentRecord = null;
                try {
                    recognition.start();
                } catch (error) {
                    alert('ìŒì„± ì¸ì‹ì„ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            }
        }

        function updateMicButton() {
            const btn = document.getElementById('mic-button');
            const status = document.getElementById('mic-status');
            if (btn && status) {
                if (isListening) {
                    btn.className = 'mic-button listening';
                    btn.innerHTML = 'ğŸ”´';
                    status.textContent = 'ğŸ”´ ë“£ê³  ìˆìŠµë‹ˆë‹¤...';
                } else {
                    btn.className = 'mic-button';
                    btn.innerHTML = 'ğŸ¤';
                    status.textContent = 'ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë§ì”€í•˜ì„¸ìš”';
                }
            }
        }

        function handleTextSubmit() {
            const text = document.getElementById('input-text').value.trim();
            if (text) {
                analyzeText(text);
            }
        }

        function saveRecord() {
            if (currentRecord) {
                records.unshift(currentRecord);
                currentRecord = null;
                document.getElementById('input-text').value = '';
                alert('ì˜ë†ì¼ì§€ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“');
                renderInputView();
                updateRecordCount();
            }
        }

        function deleteRecord(id) {
            if (confirm('ì´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                records = records.filter(r => r.id !== id);
                renderListView();
                updateRecordCount();
            }
        }

        function updateRecordCount() {
            document.getElementById('record-count').textContent = `(${records.length})`;
        }

        function setView(view) {
            currentView = view;
            document.getElementById('btn-input').className = view === 'input' ? 'active' : '';
            document.getElementById('btn-list').className = view === 'list' ? 'active' : '';
            document.getElementById('btn-stats').className = view === 'stats' ? 'active' : '';
            document.getElementById('btn-report').className = view === 'report' ? 'active' : '';

            if (view === 'input') renderInputView();
            else if (view === 'list') renderListView();
            else if (view === 'stats') renderStatsView();
            else if (view === 'report') renderReportView();
        }

        function setInputMode(mode) {
            inputMode = mode;
            renderInputView();
        }

        function renderInputView() {
            const inputText = document.getElementById('input-text')?.value || '';
            
            let html = '<div class="card">';
            html += '<div class="mode-switch">';
            html += `<button class="${inputMode === 'voice' ? 'active' : ''}" onclick="setInputMode('voice')">ğŸ¤ ìŒì„± ì…ë ¥</button>`;
            html += `<button class="${inputMode === 'text' ? 'active' : ''}" onclick="setInputMode('text')">âŒ¨ï¸ í…ìŠ¤íŠ¸ ì…ë ¥</button>`;
            html += '</div>';

            if (inputMode === 'voice') {
                html += '<h3>ğŸ¤ ìŒì„±ìœ¼ë¡œ ë§ì”€í•´ì£¼ì„¸ìš”</h3>';
                html += '<div class="mic-container">';
                html += '<button id="mic-button" class="mic-button" onclick="toggleListening()">ğŸ¤</button>';
                html += '<p id="mic-status" class="mic-status">ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë§ì”€í•˜ì„¸ìš”</p>';
                html += '<p class="mic-hint">ì˜ˆ: "ì‚¬ê³¼ 100ìƒì ìˆ˜í™•í–ˆì–´ íŠ¹í’ˆ"</p>';
                html += '</div>';
                html += `<input type="text" id="input-text" value="${inputText}" style="display:none;">`;
            } else {
                html += '<h3>ğŸ“ ì˜ë† í™œë™ ì…ë ¥</h3>';
                html += `<textarea id="input-text" placeholder='ì˜ˆ: "ì‚¬ê³¼ 100ìƒì ìˆ˜í™•í–ˆì–´", "í¬ë„ 50í‚¬ë¡œ ë†í˜‘ì— ì¶œí•˜í–ˆì–´"' rows="4">${inputText}</textarea>`;
                html += '<button class="btn btn-primary" onclick="handleTextSubmit()">ğŸ”¨ ë¶„ì„í•˜ê¸°</button>';
            }

            html += '<div class="info-box">';
            html += '<p>ğŸ’¡ <strong>ì…ë ¥ ì˜ˆì‹œ:</strong> "ì‚¬ê³¼ 100ìƒì ìˆ˜í™•í–ˆì–´ íŠ¹í’ˆ", "í† ë§ˆí†  ìˆ˜í™•í•´ì„œ ì €ì˜¨ì°½ê³ ì— ë³´ê´€í–ˆì–´"</p>';
            html += '</div></div>';

            if (inputText && inputMode === 'voice') {
                html += '<div class="card">';
                html += '<h3>ğŸ¤ ì¸ì‹ëœ ìŒì„±</h3>';
                html += `<p style="font-size: 1.1rem; color: #374151;">${inputText}</p>`;
                html += '</div>';
            }

            if (currentRecord) {
                html += '<div class="card">';
                html += '<h3><span style="font-size: 1.5rem;">âœ…</span> ìë™ ìƒì„±ëœ ì˜ë†ì¼ì§€</h3>';
                html += '<div class="result-box">';
                html += '<p class="result-label">ì…ë ¥í•œ ë‚´ìš©</p>';
                html += `<p class="result-value">"${currentRecord.rawText}"</p>`;
                html += '</div>';
                html += '<div class="grid">';
                html += '<div class="stat-card green">';
                html += '<p class="result-label">ğŸ“… ë‚ ì§œ/ì‹œê°„</p>';
                html += `<p style="font-weight: 600; color: #1f2937;">${currentRecord.date}</p>`;
                html += '</div>';
                html += '<div class="stat-card green">';
                html += '<p class="result-label">ğŸŒ± ì‘ë¬¼</p>';
                html += `<p style="font-weight: 600; color: #15803d; font-size: 1.2rem;">${currentRecord.crop}</p>`;
                html += '</div>';
                html += '<div class="stat-card blue">';
                html += '<p class="result-label">ğŸ”§ ì‘ì—…</p>';
                html += `<p style="font-weight: 600; color: #1e40af; font-size: 1.2rem;">${currentRecord.task}</p>`;
                html += '</div>';
                
                if (currentRecord.quantity && currentRecord.unit) {
                    html += '<div class="stat-card purple">';
                    html += '<p class="result-label">ğŸ“¦ ìˆ˜ëŸ‰</p>';
                    html += `<p style="font-weight: 600; color: #7c3aed; font-size: 1.2rem;">${currentRecord.quantity}${currentRecord.unit}</p>`;
                    html += '</div>';
                }
                
                if (currentRecord.quality) {
                    html += '<div class="stat-card purple">';
                    html += '<p class="result-label">â­ í’ˆì§ˆ</p>';
                    html += `<p style="font-weight: 600; color: #7c3aed; font-size: 1.2rem;">${currentRecord.quality}</p>`;
                    html += '</div>';
                }
                
                if (currentRecord.buyer) {
                    html += '<div class="stat-card blue">';
                    html += '<p class="result-label">ğŸª ì¶œí•˜ì²˜</p>';
                    html += `<p style="font-weight: 600; color: #1e40af; font-size: 1.2rem;">${currentRecord.buyer}</p>`;
                    html += '</div>';
                }
                
                if (currentRecord.storage) {
                    html += '<div class="stat-card green">';
                    html += '<p class="result-label">ğŸ“¦ ì €ì¥</p>';
                    html += `<p style="font-weight: 600; color: #15803d; font-size: 1.2rem;">${currentRecord.storage}</p>`;
                    html += '</div>';
                }
                
                html += '</div>';
                html += '<button class="btn btn-primary" onclick="saveRecord()" style="font-size: 1.1rem;">ğŸ’¾ ì˜ë†ì¼ì§€ ì €ì¥í•˜ê¸°</button>';
                html += '</div>';
            }

            document.getElementById('content').innerHTML = html;
        }

        function renderListView() {
            let html = '<div class="card">';
            html += '<h3>ğŸ“… ì˜ë†ì¼ì§€ ëª©ë¡</h3>';

            if (records.length === 0) {
                html += '<div class="empty-state">';
                html += '<div class="empty-icon">ğŸ”­</div>';
                html += '<p>ì•„ì§ ê¸°ë¡ëœ ì˜ë†ì¼ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                html += '<p style="font-size: 0.9rem; margin-top: 0.5rem;">ì¼ì§€ ì‘ì„± íƒ­ì—ì„œ ì²« ê¸°ë¡ì„ ë‚¨ê²¨ë³´ì„¸ìš”!</p>';
                html += '</div>';
            } else {
                records.forEach(record => {
                    html += '<div class="record-item">';
                    html += '<div class="record-header">';
                    html += `<div><span class="record-date">${record.date}</span>`;
                    if (record.workCategory && record.workCategory !== 'ë¯¸ì‚¬ìš©') {
                        html += `<span class="tag" style="background: #fef3c7; color: #92400e; margin-left: 0.5rem;">${record.workCategory}</span>`;
                    }
                    html += `</div>`;
                    html += `<button class="delete-btn" onclick="deleteRecord(${record.id})">ğŸ—‘ï¸</button>`;
                    html += '</div>';
                    html += '<div class="tags">';
                    html += `<span class="tag green">ğŸŒ± ${record.crop}</span>`;
                    html += `<span class="tag blue">ğŸ”§ ${record.task}</span>`;
                    if (record.quantity && record.unit) {
                        html += `<span class="tag purple">ğŸ“¦ ${record.quantity}${record.unit}</span>`;
                    }
                    if (record.quality) {
                        html += `<span class="tag purple">â­ ${record.quality}</span>`;
                    }
                    if (record.buyer) {
                        html += `<span class="tag blue">ğŸª ${record.buyer}</span>`;
                    }
                    html += '</div>';
                    html += `<div class="record-text">"${record.rawText}"</div>`;
                    html += '</div>';
                });
            }

            html += '</div>';
            document.getElementById('content').innerHTML = html;
        }

        function renderStatsView() {
            let html = '<div>';

            if (records.length === 0) {
                html += '<div class="card"><div class="empty-state">';
                html += '<div class="empty-icon">ğŸ“Š</div>';
                html += '<p>í†µê³„ë¥¼ ë³´ë ¤ë©´ ë¨¼ì € ì˜ë†ì¼ì§€ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”!</p>';
                html += '</div></div>';
            } else {
                const cropCount = {};
                const taskCount = {};
                
                records.forEach(record => {
                    cropCount[record.crop] = (cropCount[record.crop] || 0) + 1;
                    taskCount[record.task] = (taskCount[record.task] || 0) + 1;
                });

                html += '<div class="summary-card">';
                html += '<h3>ğŸ“ˆ ì „ì²´ ìš”ì•½</h3>';
                html += '<div class="summary-grid">';
                html += '<div class="summary-item">';
                html += '<p class="summary-label">ì´ ê¸°ë¡</p>';
                html += `<p class="summary-value">${records.length}ê±´</p>`;
                html += '</div>';
                html += '<div class="summary-item">';
                html += '<p class="summary-label">ê´€ë¦¬ ì‘ë¬¼</p>';
                html += `<p class="summary-value">${Object.keys(cropCount).length}ì¢…</p>`;
                html += '</div>';
                html += '<div class="summary-item">';
                html += '<p class="summary-label">ìˆ˜í–‰ ì‘ì—…</p>';
                html += `<p class="summary-value">${Object.keys(taskCount).length}ì¢…</p>`;
                html += '</div>';
                html += '</div></div>';

                html += '<div class="card">';
                html += '<h3>ğŸŒ± ì‘ë¬¼ë³„ ê´€ë¦¬ í˜„í™©</h3>';
                Object.entries(cropCount)
                    .sort((a, b) => b[1] - a[1])
                    .forEach(([crop, count]) => {
                        const percentage = Math.max((count / records.length) * 100, 15);
                        html += '<div class="stat-bar-container">';
                        html += `<div class="stat-label">${crop}</div>`;
                        html += '<div class="stat-bar-bg">';
                        html += `<div class="stat-bar green" style="width: ${percentage}%">${count}ê±´</div>`;
                        html += '</div></div>';
                    });
                html += '</div>';

                html += '<div class="card">';
                html += '<h3>ğŸ”§ ì‘ì—… ìœ í˜• ë¶„ì„</h3>';
                Object.entries(taskCount)
                    .sort((a, b) => b[1] - a[1])
                    .forEach(([task, count]) => {
                        const percentage = Math.max((count / records.length) * 100, 15);
                        html += '<div class="stat-bar-container">';
                        html += `<div class="stat-label">${task}</div>`;
                        html += '<div class="stat-bar-bg">';
                        html += `<div class="stat-bar blue" style="width: ${percentage}%">${count}ê±´</div>`;
                        html += '</div></div>';
                    });
                html += '</div>';
            }

            html += '</div>';
            document.getElementById('content').innerHTML = html;
        }

        function renderReportView() {
            let html = '<div class="card">';
            html += '<h3>ğŸ“‹ ì˜ë†ì¼ì§€ ì¶œë ¥</h3>';

            if (records.length === 0) {
                html += '<div class="empty-state">';
                html += '<div class="empty-icon">ğŸ“‹</div>';
                html += '<p>ê¸°ë¡ì´ ì—†ì–´ì„œ ì˜ë†ì¼ì§€ë¥¼ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
                html += '</div></div>';
                document.getElementById('content').innerHTML = html;
                return;
            }

            const monthlyData = {};
            records.forEach(record => {
                const date = new Date(record.timestamp);
                const yearMonth = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                if (!monthlyData[yearMonth]) {
                    monthlyData[yearMonth] = [];
                }
                monthlyData[yearMonth].push(record);
            });

            html += '<div style="margin-bottom: 1.5rem;">';
            html += '<label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">ì¡°íšŒí•  ì›” ì„ íƒ:</label>';
            html += '<select id="month-select" onchange="generateMonthlyReport()" style="width: 100%; padding: 0.75rem; border: 2px solid #d1d5db; border-radius: 0.5rem; font-size: 1rem;">';
            html += '<option value="">-- ì›” ì„ íƒ --</option>';
            Object.keys(monthlyData).sort().reverse().forEach(month => {
                const [year, m] = month.split('-');
                html += `<option value="${month}">${year}ë…„ ${parseInt(m)}ì›”</option>`;
            });
            html += '</select></div>';

            html += '<div id="monthly-report-container"></div>';
            html += '</div>';

            document.getElementById('content').innerHTML = html;
        }

        function generateMonthlyReport() {
            const selectedMonth = document.getElementById('month-select').value;
            if (!selectedMonth) {
                document.getElementById('monthly-report-container').innerHTML = '';
                return;
            }

            const monthRecords = records.filter(record => {
                const date = new Date(record.timestamp);
                const yearMonth = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                return yearMonth === selectedMonth;
            });

            const dailyData = {};
            monthRecords.forEach(record => {
                const date = new Date(record.timestamp);
                const dateKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
                if (!dailyData[dateKey]) {
                    dailyData[dateKey] = [];
                }
                dailyData[dateKey].push(record);
            });

            const [year, month] = selectedMonth.split('-');
            
            let html = '<div style="background: white; padding: 2rem; border-radius: 1rem; border: 2px solid #e5e7eb;">';
            html += `<div style="text-align: center; margin-bottom: 2rem; border-bottom: 3px solid #16a34a; padding-bottom: 1rem;">`;
            html += `<h2 style="font-size: 2rem; color: #1f2937; margin-bottom: 0.5rem;">ì˜ë†ì¼ì§€</h2>`;
            html += `<p style="font-size: 1.2rem; color: #6b7280;">${year}ë…„ ${parseInt(month)}ì›”</p>`;
            html += `</div>`;

            html += '<table style="width: 100%; border-collapse: collapse; margin-bottom: 2rem;">';
            html += '<thead>';
            html += '<tr style="background: #f3f4f6; border: 2px solid #374151;">';
            html += '<th style="padding: 1rem; border: 1px solid #374151; width: 15%;">ë…„ì›”ì¼</th>';
            html += '<th style="padding: 1rem; border: 1px solid #374151; width: 25%;">ì£¼ìš” ë†ì‘ì—…</th>';
            html += '<th style="padding: 1rem; border: 1px solid #374151; width: 30%;">ë†ìì¬ ì‚¬ìš©ë‚´ì—­<br>(ë¹„ë£Œ, ì•½ì¬)</th>';
            html += '<th style="padding: 1rem; border: 1px solid #374151; width: 30%;">ìƒì‚°, ì¶œí•˜ ë‚´ì—­</th>';
            html += '</tr>';
            html += '</thead>';
            html += '<tbody>';

            const sortedDates = Object.keys(dailyData).sort();
            
            sortedDates.forEach(dateKey => {
                const dayRecords = dailyData[dateKey];
                const [y, m, d] = dateKey.split('-');
                
                const mainWorks = [];
                const materials = [];
                const productions = [];

                dayRecords.forEach(record => {
                    if (record.task !== 'ë¯¸ë¶„ë¥˜') {
                        const workText = `${record.crop} ${record.task}`;
                        if (!mainWorks.includes(workText)) {
                            mainWorks.push(workText);
                        }
                    }

                    if (record.workCategory === 'ìƒì‚°ì‘ì—…' || record.workCategory === 'ì¶œí•˜ì‘ì—…') {
                        let productionText = `${record.crop} ${record.task}`;
                        
                        const details = [];
                        if (record.quantity && record.unit) {
                            details.push(`${record.quantity}${record.unit}`);
                        }
                        if (record.quality) {
                            details.push(record.quality);
                        }
                        if (record.storage) {
                            details.push(record.storage);
                        }
                        if (record.buyer) {
                            details.push(record.buyer);
                        }
                        
                        if (details.length > 0) {
                            productionText += ` (${details.join(', ')})`;
                        }
                        
                        if (!productions.includes(productionText)) {
                            productions.push(productionText);
                        }
                    }
                });

                html += '<tr>';
                html += `<td style="padding: 0.75rem; border: 1px solid #d1d5db; text-align: center; font-weight: 600;">${parseInt(m)}/${parseInt(d)}</td>`;
                html += `<td style="padding: 0.75rem; border: 1px solid #d1d5db; vertical-align: top;">${mainWorks.join('<br>') || '-'}</td>`;
                html += `<td style="padding: 0.75rem; border: 1px solid #d1d5db; vertical-align: top;">${materials.join('<br>') || '-'}</td>`;
                html += `<td style="padding: 0.75rem; border: 1px solid #d1d5db; vertical-align: top;">${productions.join('<br>') || '-'}</td>`;
                html += '</tr>';
            });

            const emptyRows = Math.max(0, 6 - sortedDates.length);
            for (let i = 0; i < emptyRows; i++) {
                html += '<tr>';
                html += '<td style="padding: 1.5rem; border: 1px solid #d1d5db;">&nbsp;</td>';
                html += '<td style="padding: 1.5rem; border: 1px solid #d1d5db;">&nbsp;</td>';
                html += '<td style="padding: 1.5rem; border: 1px solid #d1d5db;">&nbsp;</td>';
                html += '<td style="padding: 1.5rem; border: 1px solid #d1d5db;">&nbsp;</td>';
                html += '</tr>';
            }

            html += '</tbody>';
            html += '</table>';

            html += '<div style="text-align: center; margin-top: 2rem;">';
            html += '<button onclick="printReport()" class="btn btn-primary" style="width: auto; padding: 1rem 2rem;">ğŸ–¨ï¸ ì˜ë†ì¼ì§€ ì¸ì‡„í•˜ê¸°</button>';
            html += '</div>';

            html += '</div>';

            document.getElementById('monthly-report-container').innerHTML = html;
        }

        function printReport() {
            window.print();
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        document.addEventListener('DOMContentLoaded', function() {
            initSpeechRecognition();
            updateRecordCount();
            renderInputView();
            
            // ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('btn-input').addEventListener('click', () => setView('input'));
            document.getElementById('btn-list').addEventListener('click', () => setView('list'));
            document.getElementById('btn-stats').addEventListener('click', () => setView('stats'));
            document.getElementById('btn-report').addEventListener('click', () => setView('report'));
        });
    </script>
</body>
</html>
